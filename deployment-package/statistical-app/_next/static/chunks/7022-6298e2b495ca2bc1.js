"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7022],{37022:(t,e,r)=>{r.d(e,{G:()=>s});class s{static loadSessions(){try{let t=localStorage.getItem(this.SESSIONS_KEY);if(!t)return[];return JSON.parse(t).filter(t=>!t.isArchived).sort((t,e)=>e.updatedAt-t.updatedAt)}catch(t){return[]}}static loadArchivedSessions(){try{let t=localStorage.getItem(this.SESSIONS_KEY);if(!t)return[];return JSON.parse(t).filter(t=>t.isArchived).sort((t,e)=>e.updatedAt-t.updatedAt)}catch(t){return[]}}static loadSession(t){try{var e;return null!=(e=this.loadAllSessions().find(e=>e.id===t))?e:null}catch(t){return null}}static saveSession(t){try{let e=this.loadAllSessions(),r=e.findIndex(e=>e.id===t.id);r>=0?e[r]={...t,updatedAt:Date.now()}:e.push({...t,updatedAt:Date.now()}),this.saveAllSessions(e),this.cleanupIfNeeded()}catch(t){throw Error("세션 저장에 실패했습니다.")}}static addMessage(t,e){try{let r=this.loadSession(t);if(!r)throw Error("Session not found");r.messages.push(e),r.updatedAt=Date.now(),1===r.messages.length&&(r.title=this.generateTitle(e.content)),this.saveSession(r)}catch(t){throw Error("메시지 추가에 실패했습니다.")}}static deleteMessage(t,e){try{let r=this.loadSession(t);if(!r)throw Error("Session not found");r.messages=r.messages.filter(t=>t.id!==e),r.updatedAt=Date.now(),this.saveSession(r)}catch(t){throw Error("메시지 삭제에 실패했습니다.")}}static deleteSession(t){try{let e=this.loadAllSessions().filter(e=>e.id!==t);this.saveAllSessions(e)}catch(t){throw Error("세션 삭제에 실패했습니다.")}}static toggleFavorite(t){try{let e=this.loadAllSessions(),r=e.find(e=>e.id===t);if(!r)throw Error("Session not found");r.isFavorite=!r.isFavorite,r.updatedAt=Date.now(),this.saveAllSessions(e)}catch(t){throw Error("즐겨찾기 설정에 실패했습니다.")}}static renameSession(t,e){try{let r=this.loadAllSessions(),s=r.find(e=>e.id===t);if(!s)throw Error("Session not found");s.title=e.trim()||"제목 없음",s.updatedAt=Date.now(),this.saveAllSessions(r)}catch(t){throw Error("세션 이름 변경에 실패했습니다.")}}static toggleArchive(t){try{let e=this.loadAllSessions(),r=e.find(e=>e.id===t);if(!r)throw Error("Session not found");r.isArchived=!r.isArchived,r.updatedAt=Date.now(),this.saveAllSessions(e)}catch(t){throw Error("보관 설정에 실패했습니다.")}}static createNewSession(){let t={id:this.generateId(),title:"새 대화",messages:[],createdAt:Date.now(),updatedAt:Date.now(),isFavorite:!1,isArchived:!1};return this.saveSession(t),t}static loadSettings(){try{let t=localStorage.getItem(this.SETTINGS_KEY);if(!t)return{floatingButtonEnabled:!0,theme:"system"};return JSON.parse(t)}catch(t){return{floatingButtonEnabled:!0,theme:"system"}}}static saveSettings(t){try{localStorage.setItem(this.SETTINGS_KEY,JSON.stringify(t))}catch(t){throw Error("설정 저장에 실패했습니다.")}}static generateTitle(t){let e=t.trim().replace(/\n/g," ");return 0===e.length?"새 대화":e.length<=30?e:e.substring(0,27)+"..."}static generateId(){return"".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,9))}static loadAllSessions(){try{let t=localStorage.getItem(this.SESSIONS_KEY);if(!t)return[];return JSON.parse(t)}catch(t){return[]}}static saveAllSessions(t){try{let e=JSON.stringify(t);localStorage.setItem(this.SESSIONS_KEY,e)}catch(t){throw Error("세션 저장에 실패했습니다.")}}static cleanupIfNeeded(){try{let t=localStorage.getItem(this.SESSIONS_KEY);if(!t)return;if(t.length>this.MAX_SIZE)return void this.cleanupBySize();let e=JSON.parse(t),r=e.filter(t=>!t.isArchived);r.length>this.MAX_SESSIONS&&this.cleanupByCount(e,r)}catch(t){}}static cleanupBySize(){let t=this.loadAllSessions().filter(t=>!t.isFavorite).sort((t,e)=>t.updatedAt-e.updatedAt);if(t.length>0){let e=t[0];this.deleteSession(e.id),this.cleanupIfNeeded()}}static cleanupByCount(t,e){let r=e.filter(t=>!t.isFavorite).sort((t,e)=>t.updatedAt-e.updatedAt),s=e.length-this.MAX_SESSIONS;if(s>0&&r.length>0){let e=r.slice(0,s),i=t.filter(t=>!e.some(e=>e.id===t.id));this.saveAllSessions(i)}}static clearAll(){try{localStorage.removeItem(this.SESSIONS_KEY),localStorage.removeItem(this.PROJECTS_KEY),localStorage.removeItem(this.SETTINGS_KEY),localStorage.removeItem(this.MIGRATION_KEY)}catch(t){}}static createProject(t,e){let r={id:this.generateId(),name:t.trim()||"새 프로젝트",description:null==e?void 0:e.description,emoji:null==e?void 0:e.emoji,color:null==e?void 0:e.color,createdAt:Date.now(),updatedAt:Date.now(),isArchived:!1,isFavorite:!1},s=this.loadAllProjects();return s.push(r),this.saveAllProjects(s),r}static getProjects(){try{return this.loadAllProjects().filter(t=>!t.isArchived).sort((t,e)=>e.updatedAt-t.updatedAt)}catch(t){return[]}}static updateProject(t,e){try{let r=this.loadAllProjects(),s=r.find(e=>e.id===t);if(!s)return null;return Object.assign(s,e,{updatedAt:Date.now()}),this.saveAllProjects(r),s}catch(t){return null}}static deleteProject(t){try{let e=this.loadAllProjects().filter(e=>e.id!==t);this.saveAllProjects(e);let r=this.loadAllSessions().map(e=>e.projectId===t?{...e,projectId:void 0}:e);this.saveAllSessions(r)}catch(t){throw Error("프로젝트 삭제에 실패했습니다.")}}static toggleProjectArchive(t){try{let e=this.loadAllProjects(),r=e.find(e=>e.id===t);if(!r)throw Error("Project not found");r.isArchived=!r.isArchived,r.updatedAt=Date.now(),this.saveAllProjects(e)}catch(t){throw Error("프로젝트 보관 설정에 실패했습니다.")}}static toggleProjectFavorite(t){try{let e=this.loadAllProjects(),r=e.find(e=>e.id===t);if(!r)throw Error("Project not found");r.isFavorite=!r.isFavorite,r.updatedAt=Date.now(),this.saveAllProjects(e)}catch(t){throw Error("프로젝트 즐겨찾기 설정에 실패했습니다.")}}static moveSessionToProject(t,e){try{let r=this.loadAllSessions(),s=r.find(e=>e.id===t);if(!s||null!==e&&!this.loadAllProjects().some(t=>t.id===e))return null;return s.projectId=null!=e?e:void 0,s.updatedAt=Date.now(),this.saveAllSessions(r),s}catch(t){return null}}static getSessionsByProject(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"recent";try{let r=this.loadSessions().filter(e=>e.projectId===t);return"recent"===e?r.sort((t,e)=>e.updatedAt-t.updatedAt):r.sort((t,e)=>t.updatedAt-e.updatedAt)}catch(t){return[]}}static getUnorganizedSessions(){try{return this.loadSessions().filter(t=>!t.projectId).sort((t,e)=>e.updatedAt-t.updatedAt)}catch(t){return[]}}static getFavoriteSessions(){try{return this.loadSessions().filter(t=>t.isFavorite).sort((t,e)=>e.updatedAt-t.updatedAt)}catch(t){return[]}}static getFavoriteProjects(){try{return this.loadAllProjects().filter(t=>t.isFavorite&&!t.isArchived).sort((t,e)=>e.updatedAt-t.updatedAt)}catch(t){return[]}}static searchSessions(t,e){try{let r=this.loadSessions(),s=t.toLowerCase().trim(),i=s?r.filter(t=>t.title.toLowerCase().includes(s)):r;return(null==e?void 0:e.projectId)&&(i=i.filter(t=>t.projectId===e.projectId)),i.sort((t,e)=>e.updatedAt-t.updatedAt),(null==e?void 0:e.limit)&&e.limit>0&&(i=i.slice(0,e.limit)),i}catch(t){return[]}}static searchProjects(t){try{let e=this.getProjects(),r=t.toLowerCase().trim();if(!r)return e;return e.filter(t=>t.name.toLowerCase().includes(r)||t.description&&t.description.toLowerCase().includes(r)).sort((t,e)=>e.updatedAt-t.updatedAt)}catch(t){return[]}}static globalSearch(t){return{projects:this.searchProjects(t),sessions:this.searchSessions(t)}}static migrateToNewStructure(){try{if("true"===localStorage.getItem(this.MIGRATION_KEY))return;let t=this.loadAllSessions(),e=0;t.forEach(t=>{!("projectId"in t)&&(t.projectId=void 0,e++)}),e>0&&this.saveAllSessions(t),localStorage.setItem(this.MIGRATION_KEY,"true")}catch(t){}}static loadAllProjects(){try{let t=localStorage.getItem(this.PROJECTS_KEY);if(!t)return[];return JSON.parse(t)}catch(t){return[]}}static saveAllProjects(t){try{let e=JSON.stringify(t);localStorage.setItem(this.PROJECTS_KEY,e)}catch(t){throw Error("프로젝트 저장에 실패했습니다.")}}}s.SESSIONS_KEY="rag-chat-sessions",s.PROJECTS_KEY="rag-chat-projects",s.SETTINGS_KEY="rag-chat-settings",s.MIGRATION_KEY="rag-chat-migrated-v2",s.MAX_SIZE=45e5,s.MAX_SESSIONS=20}}]);