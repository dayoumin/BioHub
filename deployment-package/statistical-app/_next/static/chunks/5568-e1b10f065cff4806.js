"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5568],{25016:(e,t,n)=>{n.d(t,{cn:()=>o});var r=n(2821),i=n(75889);function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,i.QP)((0,r.$)(t))}},36225:(e,t,n)=>{n.d(t,{_c:()=>u,PE:()=>m,H0:()=>h});class r{async initialize(){}async cleanup(){}async addDocument(e){throw Error("addDocument not implemented")}async getDocument(e){throw Error("getDocument not implemented")}async updateDocument(e,t){throw Error("updateDocument not implemented")}async deleteDocument(e){throw Error("deleteDocument not implemented")}getDocumentCount(){throw Error("getDocumentCount not implemented")}getAllDocuments(){throw Error("getAllDocuments not implemented")}constructor(e){this.config=e}}let i="userDocuments";function o(){return new Promise((e,t)=>{let n=indexedDB.open("RAGSystemDB",1);n.onerror=()=>{t(Error("IndexedDB 열기 실패"))},n.onsuccess=()=>{e(n.result)},n.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains(i)){let e=t.createObjectStore(i,{keyPath:"doc_id"});e.createIndex("library","library",{unique:!1}),e.createIndex("created_at","created_at",{unique:!1})}}})}class a{static async saveDocument(e){let t=await o();return new Promise((n,r)=>{let o=t.transaction([i],"readwrite"),a=o.objectStore(i).put(e);a.onsuccess=()=>{n()},a.onerror=()=>{r(Error("문서 저장 실패: ".concat(e.doc_id)))},o.oncomplete=()=>{t.close()}})}static async getDocument(e){let t=await o();return new Promise((n,r)=>{let o=t.transaction([i],"readonly"),a=o.objectStore(i).get(e);a.onsuccess=()=>{n(a.result||null)},a.onerror=()=>{r(Error("문서 조회 실패: ".concat(e)))},o.oncomplete=()=>{t.close()}})}static async getAllDocuments(){let e=await o();return new Promise((t,n)=>{let r=e.transaction([i],"readonly"),o=r.objectStore(i).getAll();o.onsuccess=()=>{t(o.result)},o.onerror=()=>{n(Error("문서 목록 조회 실패"))},r.oncomplete=()=>{e.close()}})}static async deleteDocument(e){let t=await o();return new Promise((n,r)=>{let o=t.transaction([i],"readwrite"),a=o.objectStore(i).delete(e);a.onsuccess=()=>{n()},a.onerror=()=>{r(Error("문서 삭제 실패: ".concat(e)))},o.oncomplete=()=>{t.close()}})}static async clearAllDocuments(){let e=await o();return new Promise((t,n)=>{let r=e.transaction([i],"readwrite"),o=r.objectStore(i).clear();o.onsuccess=()=>{t()},o.onerror=()=>{n(Error("모든 문서 삭제 실패"))},r.oncomplete=()=>{e.close()}})}static async getDocumentCount(){let e=await o();return new Promise((t,n)=>{let r=e.transaction([i],"readonly"),o=r.objectStore(i).count();o.onsuccess=()=>{t(o.result)},o.onerror=()=>{n(Error("문서 개수 조회 실패"))},r.oncomplete=()=>{e.close()}})}}async function s(){return"function"==typeof window.initSqlJs?await window.initSqlJs({locateFile:e=>"https://sql.js.org/dist/".concat(e)}):new Promise((e,t)=>{let n=document.createElement("script");n.src="/sql-wasm/sql-wasm.js",n.async=!0,n.onload=async()=>{try{if("function"==typeof window.initSqlJs){let t=await window.initSqlJs({locateFile:e=>"/sql-wasm/".concat(e)});e(t)}else throw Error("로컬 sql.js 로드 실패")}catch(n){c(e,t)}},n.onerror=()=>{c(e,t)},document.head.appendChild(n)})}function c(e,t){let n=document.createElement("script");n.src="https://sql.js.org/dist/sql-wasm.js",n.async=!0,n.onload=async()=>{try{if("function"==typeof window.initSqlJs){let t=await window.initSqlJs({locateFile:e=>"https://sql.js.org/dist/".concat(e)});e(t)}else t(Error("sql.js 로드 실패"))}catch(e){t(e)}},n.onerror=()=>{t(Error("sql.js CDN 스크립트 로드 실패"))},document.head.appendChild(n)}class l extends r{async initialize(){try{let e=await fetch("".concat(this.ollamaEndpoint,"/api/tags"));if(!e.ok)throw Error("Ollama 서버에 연결할 수 없습니다");let t=await e.json();if("object"!=typeof t||null===t)throw Error("Ollama API 응답이 유효하지 않습니다");if(!Array.isArray(t.models))throw Error("Ollama API에서 모델 목록을 찾을 수 없습니다");let r=t.models.map(e=>"object"==typeof e&&null!==e&&"string"==typeof e.name?{name:e.name}:null).filter(e=>null!==e);if(0===r.length)throw Error("Ollama에 설치된 모델이 없습니다");if(this.embeddingModel){if(!r.some(e=>e.name.includes(this.embeddingModel)))throw Error("임베딩 모델 '".concat(this.embeddingModel,"'이 설치되지 않았습니다.\n")+"다음 명령어로 설치하세요: ollama pull ".concat(this.embeddingModel))}else try{let{getRecommendedEmbeddingModel:e}=await n.e(6647).then(n.bind(n,66647)),t=await e(this.ollamaEndpoint);if(t)this.embeddingModel=t;else throw Error("추천할 임베딩 모델을 찾을 수 없습니다")}catch(t){let e=r.find(e=>e.name.toLowerCase().includes("nomic-embed"))||r.find(e=>{let t=e.name.toLowerCase();return t.includes("embed")&&t.includes("text")})||r.find(e=>{let t=e.name.toLowerCase();return t.includes("embed")||t.includes("embedding")});if(!e){let e=r.map(e=>e.name).join(", ");throw Error("임베딩 모델을 찾을 수 없습니다.\n"+"사용 가능한 모델: ".concat(e||"없음","\n")+"다음 명령어로 설치하세요: ollama pull nomic-embed-text")}this.embeddingModel=e.name}if(this.inferenceModel){if(!r.some(e=>e.name.includes(this.inferenceModel)))throw Error("추론 모델 '".concat(this.inferenceModel,"'이 설치되지 않았습니다.\n")+"다음 명령어로 설치하세요: ollama pull ".concat(this.inferenceModel))}else try{let{getRecommendedModel:e}=await n.e(6647).then(n.bind(n,66647)),t=await e(this.ollamaEndpoint);if(t)this.inferenceModel=t;else throw Error("추천할 추론 모델을 찾을 수 없습니다")}catch(t){let e=r.filter(e=>!e.name.toLowerCase().includes("embed")&&!e.name.toLowerCase().includes("embedding")).sort((e,t)=>{let n=e=>{let t=e.toLowerCase();return t.includes("qwen")?0:t.includes("gemma")?1:t.includes("deepseek")?2:t.includes("llama")?3:4};return n(e.name)-n(t.name)})[0];if(!e){let e=r.map(e=>e.name).join(", ");throw Error("추론 가능한 모델을 찾을 수 없습니다.\n"+"설치된 모델: ".concat(e||"없음","\n")+"다음 중 하나를 설치하세요:\n  ollama pull qwen3\n  ollama pull gemma3\n  ollama pull llama3.2\n  또는 다른 대형 언어 모델")}this.inferenceModel=e.name}await this.loadSQLiteDB(),this.isInitialized=!0}catch(e){throw e}}async isReady(){return this.isInitialized}async getAllAvailableModels(){try{let e=await fetch("".concat(this.ollamaEndpoint,"/api/tags"));if(!e.ok)return[];return(await e.json()).models||[]}catch(e){return[]}}async getAvailableEmbeddingModels(){return(await this.getAllAvailableModels()).filter(e=>e.name.toLowerCase().includes("embed")||e.name.toLowerCase().includes("embedding")).map(e=>e.name)}async getAvailableInferenceModels(){return(await this.getAllAvailableModels()).filter(e=>!e.name.toLowerCase().includes("embed")&&!e.name.toLowerCase().includes("embedding")).map(e=>e.name)}async cleanup(){this.db&&(this.db.close(),this.db=null),this.documents=[],this.isInitialized=!1,this.testMode||await a.clearAllDocuments()}ensureInitialized(){if(!this.isInitialized)throw Error("OllamaProvider가 초기화되지 않았습니다")}findDocumentIndex(e){let t=this.documents.findIndex(t=>t.doc_id===e);return -1===t?null:t}escapeSQL(e){return e.replace(/'/g,"''")}async addDocument(e){this.ensureInitialized();let t=e.doc_id||"".concat(e.library,"_").concat(Date.now()),n={doc_id:t,title:e.title,content:e.content,library:e.library,category:e.category||null,summary:e.summary||null,embedding:null,embedding_model:null};this.documents.push(n);let r=Date.now();if(!this.testMode){let n={doc_id:t,title:e.title,content:e.content,library:e.library,category:e.category||null,summary:e.summary||null,created_at:r,updated_at:r};await a.saveDocument(n)}if(!this.testMode&&this.db){let n=Math.floor(r/1e3),i=e.content.split(/\s+/).length;this.db.exec("\n        INSERT INTO documents (\n          doc_id, title, library, category,\n          content, summary,\n          created_at, updated_at, word_count\n        ) VALUES (\n          '".concat(this.escapeSQL(t),"',\n          '").concat(this.escapeSQL(e.title),"',\n          '").concat(this.escapeSQL(e.library),"',\n          ").concat(e.category?"'".concat(this.escapeSQL(e.category),"'"):"NULL",",\n          '").concat(this.escapeSQL(e.content),"',\n          ").concat(e.summary?"'".concat(this.escapeSQL(e.summary),"'"):"NULL",",\n          ").concat(n,",\n          ").concat(n,",\n          ").concat(i,"\n        )\n      "))}return t}async updateDocument(e,t){this.ensureInitialized();let n=this.findDocumentIndex(e);if(null===n)return!1;void 0!==t.title&&(this.documents[n].title=t.title),void 0!==t.content&&(this.documents[n].content=t.content),void 0!==t.category&&(this.documents[n].category=t.category),void 0!==t.summary&&(this.documents[n].summary=t.summary);let r=Date.now();if(!this.testMode){let n=await a.getDocument(e);if(n){let e={...n,title:void 0!==t.title?t.title:n.title,content:void 0!==t.content?t.content:n.content,category:void 0!==t.category?t.category:n.category,summary:void 0!==t.summary?t.summary:n.summary,updated_at:r};await a.saveDocument(e)}}if(!this.testMode&&this.db){let n=[],i=Math.floor(r/1e3);if(void 0!==t.title&&n.push("title = '".concat(this.escapeSQL(t.title),"'")),void 0!==t.content){n.push("content = '".concat(this.escapeSQL(t.content),"'"));let e=t.content.split(/\s+/).length;n.push("word_count = ".concat(e))}void 0!==t.category&&n.push(null===t.category?"category = NULL":"category = '".concat(this.escapeSQL(t.category),"'")),void 0!==t.summary&&n.push(null===t.summary?"summary = NULL":"summary = '".concat(this.escapeSQL(t.summary),"'")),n.push("updated_at = ".concat(i)),this.db.exec("\n        UPDATE documents\n        SET ".concat(n.join(", "),"\n        WHERE doc_id = '").concat(this.escapeSQL(e),"'\n      "))}return!0}async deleteDocument(e){this.ensureInitialized();let t=this.findDocumentIndex(e);return null!==t&&(this.documents.splice(t,1),this.testMode||await a.deleteDocument(e),!this.testMode&&this.db&&this.db.exec("\n        DELETE FROM documents\n        WHERE doc_id = '".concat(this.escapeSQL(e),"'\n      ")),!0)}async getDocument(e){this.ensureInitialized();let t=this.documents.find(t=>t.doc_id===e);return t?{doc_id:t.doc_id,title:t.title,content:t.content,library:t.library,category:t.category||void 0,summary:t.summary||void 0}:null}getDocumentCount(){return this.documents.length}getAllDocuments(){return this.documents.map(e=>({doc_id:e.doc_id,title:e.title,content:e.content,library:e.library,category:e.category||void 0,summary:e.summary||void 0}))}async query(e){this.ensureInitialized();let t=Date.now(),n=e.searchMode||"hybrid",r=!1;try{let i=[];if("fts5"===n)i=this.searchByKeyword(e.query);else if("vector"===n)try{i=await this.searchByVector(e.query),0===i.length&&(this.documents.some(e=>null!==e.embedding)||(n="fts5",r=!0,i=this.searchByKeyword(e.query)))}catch(t){n="fts5",r=!0,i=this.searchByKeyword(e.query)}else if("hybrid"===n)try{i=await this.searchHybrid(e.query)}catch(t){n="fts5",r=!0,i=this.searchByKeyword(e.query)}0===i.length&&(i=this.documents.slice(0,this.topK).map(e=>({doc_id:e.doc_id,title:e.title,content:e.content,library:e.library,category:e.category,score:.5})));let o=this.buildContext(i,e),a=await this.generateAnswer(o,e.query),s=Date.now()-t;return{answer:a,sources:i.map(e=>({title:e.title,content:e.content.slice(0,200)+"...",score:e.score})),model:{provider:"Ollama (Local - ".concat(n.toUpperCase()).concat(r?" [Fallback]":"",")"),embedding:this.embeddingModel,inference:this.inferenceModel},metadata:{responseTime:s}}}catch(e){throw Error("Ollama Provider 오류: ".concat(e instanceof Error?e.message:"알 수 없는 오류"))}}async loadSQLiteDB(){try{var e;if(this.testMode){this.documents=[{doc_id:"scipy_ttest_ind",title:"scipy.stats.ttest_ind",content:"Calculate the T-test for the means of two independent samples of scores. This test assumes that the populations have identical variances.",library:"scipy",category:"hypothesis",summary:"Two independent samples t-test",embedding:null,embedding_model:null},{doc_id:"scipy_mannwhitneyu",title:"scipy.stats.mannwhitneyu",content:"Compute the Mann-Whitney U statistic. The Mann-Whitney U test is a nonparametric test of the null hypothesis that the distribution underlying sample x is the same as the distribution underlying sample y.",library:"scipy",category:"hypothesis",summary:"Mann-Whitney U test (nonparametric)",embedding:null,embedding_model:null},{doc_id:"numpy_mean",title:"numpy.mean",content:"Compute the arithmetic mean along the specified axis. Returns the average of the array elements.",library:"numpy",category:"descriptive",summary:"Arithmetic mean",embedding:null,embedding_model:null}];return}let t=await s(),n=await fetch(this.vectorDbPath);if(!n.ok)throw Error("DB 파일을 찾을 수 없습니다: ".concat(this.vectorDbPath));let r=await n.arrayBuffer(),i=new Uint8Array(r);this.db=new t.Database(i);let o=this.db.exec("\n        SELECT doc_id, title, content, library, category, summary, embedding, embedding_model\n        FROM documents\n        ORDER BY created_at DESC\n      ");if(0===o.length||0===o[0].values.length){this.documents=[];return}let c=o[0].columns,l=o[0].values;this.documents=l.map(e=>{let t={};if(c.forEach((n,r)=>{t[n]=e[r]}),"string"!=typeof t.doc_id||"string"!=typeof t.title||"string"!=typeof t.content||"string"!=typeof t.library)throw Error("DB 스키마 오류: 필수 필드 누락");let n=null;if(t.embedding&&t.embedding instanceof Uint8Array)try{n=function(e){let t=[],n=new DataView(e.buffer,e.byteOffset,e.byteLength);for(let r=0;r<e.byteLength;r+=4)t.push(n.getFloat32(r,!0));return t}(t.embedding)}catch(e){}return{doc_id:t.doc_id,title:t.title,content:t.content,library:t.library,category:null===t.category?null:String(t.category),summary:null===t.summary?null:String(t.summary),embedding:n,embedding_model:null===t.embedding_model?null:String(t.embedding_model)}}),this.documents.filter(e=>null!==e.embedding).length;let d=null==(e=this.documents.find(e=>null!==e.embedding_model))?void 0:e.embedding_model;d&&(this.embeddingModel&&this.embeddingModel,this.embeddingModel=d);{let e=await a.getAllDocuments();if(e.length>0){let t=e.map(e=>({doc_id:e.doc_id,title:e.title,content:e.content,library:e.library,category:e.category,summary:e.summary,embedding:null,embedding_model:null}));if(this.documents=[...this.documents,...t],this.db)for(let t of e){let e=t.content.split(/\s+/).length,n=Math.floor(t.created_at/1e3),r=Math.floor(t.updated_at/1e3);this.db.exec("\n                INSERT INTO documents (\n                  doc_id, title, library, category,\n                  content, summary,\n                  created_at, updated_at, word_count\n                ) VALUES (\n                  '".concat(this.escapeSQL(t.doc_id),"',\n                  '").concat(this.escapeSQL(t.title),"',\n                  '").concat(this.escapeSQL(t.library),"',\n                  ").concat(t.category?"'".concat(this.escapeSQL(t.category),"'"):"NULL",",\n                  '").concat(this.escapeSQL(t.content),"',\n                  ").concat(t.summary?"'".concat(this.escapeSQL(t.summary),"'"):"NULL",",\n                  ").concat(n,",\n                  ").concat(r,",\n                  ").concat(e,"\n                )\n              "))}}}}catch(e){throw Error("SQLite DB 로드 실패: ".concat(e instanceof Error?e.message:"알 수 없는 오류"))}}searchByKeyword(e){let t=e.toLowerCase(),n=[];for(let e of this.documents){let r=e.title.toLowerCase().includes(t),i=e.content.toLowerCase().includes(t);if(r||i){let t=r?.9:.7;n.push({doc_id:e.doc_id,title:e.title,content:e.content,library:e.library,category:e.category,score:t})}}return n.sort((e,t)=>t.score-e.score),n.slice(0,this.topK)}async searchByVector(e){try{Date.now();let t=await this.generateEmbedding(e);Date.now();let n=this.documents.filter(e=>null!==e.embedding);if(0===n.length)return[];let r=[];for(let e of n){let n=e.embedding,i=this.cosineSimilarity(t,n);r.push({doc_id:e.doc_id,title:e.title,content:e.content,library:e.library,category:e.category,score:i})}return r.sort((e,t)=>t.score-e.score),Date.now(),r.slice(0,this.topK)}catch(e){return[]}}async searchHybrid(e){try{let t=this.searchByKeyword(e),n=await this.searchByVector(e),r=new Map;t.forEach((e,t)=>{r.set(e.doc_id,(r.get(e.doc_id)||0)+1/(60+(t+1)))}),n.forEach((e,t)=>{r.set(e.doc_id,(r.get(e.doc_id)||0)+1/(60+(t+1)))});let i=new Map;return this.documents.forEach(e=>i.set(e.doc_id,e)),Array.from(r.entries()).map(e=>{let[t,n]=e,r=i.get(t);if(!r)throw Error("문서를 찾을 수 없습니다: ".concat(t));return{doc_id:r.doc_id,title:r.title,content:r.content,library:r.library,category:r.category,score:n}}).sort((e,t)=>t.score-e.score).slice(0,this.topK)}catch(t){return this.searchByKeyword(e)}}cosineSimilarity(e,t){if(e.length!==t.length)throw Error("벡터 길이가 다릅니다");let n=0,r=0,i=0;for(let o=0;o<e.length;o++)n+=e[o]*t[o],r+=e[o]*e[o],i+=t[o]*t[o];let o=Math.sqrt(r)*Math.sqrt(i);return 0===o?0:n/o}async generateEmbedding(e){let t=e.length>2e3?e.slice(0,2e3)+"...":e;try{let e=await fetch("".concat(this.ollamaEndpoint,"/api/embeddings"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:this.embeddingModel,input:t})});if(!e.ok){let t=e.statusText;try{let n=await e.json();t=n.error||n.message||e.statusText}catch(e){}throw Error("임베딩 생성 실패 (".concat(e.status,"): ").concat(t))}let n=await e.json();if(!n.embedding||!Array.isArray(n.embedding))throw Error("임베딩 응답 형식이 올바르지 않습니다");return n.embedding}catch(e){if(e instanceof Error)throw e;throw Error("임베딩 생성 중 알 수 없는 오류 발생")}}buildContext(e,t){let n="다음은 관련 문서입니다:\n\n";return e.forEach((e,t)=>{n+="[문서 ".concat(t+1,"] ").concat(e.title,"\n"),n+="".concat(e.content,"\n\n")}),t.method&&(n+="\n현재 사용자가 사용 중인 통계 메서드: ".concat(t.method,"\n")),n}async generateAnswer(e,t){let n="".concat('당신은 통계 분석 분야의 경험 많은 튜터입니다.\n아래 제공된 한국 통계 교육 자료를 바탕으로, 사용자의 질문에 명확하고 친근하게 답변해주세요.\n\n\n\uD83D\uDCDA 콘텐츠 참고 방식\n───────────────────────────────────\n• 제공된 자료를 최우선으로 활용하되, 관련 없으면 자유롭게 설명\n• 자료에 없는 내용은 "문서에 따르면..." 또는 "일반적으로..." 로 구분\n\n\n\uD83D\uDCAC 답변 스타일 가이드\n───────────────────────────────────\n• 마크다운으로 구조화하기: 제목(##), 리스트(-), 강조(**) 활용\n  예) "## T-검정이란?", "- 가정 1:", "**주의사항**"\n\n• 용어는 한글+영문 함께 표기\n  예) "귀무가설(Null Hypothesis)", "1종 오류(Type I Error)"\n\n• 결론 먼저 → 상세 설명 순서로\n  예) "네, 정규성 검정은 필수입니다. 이유는..."\n\n• 조건/주의사항은 명확하게 표시\n  예) "⚠️ 이 방법은 샘플이 30개 이상일 때만 권장합니다"\n\n\n\uD83D\uDEAB 피해야 할 것\n───────────────────────────────────\n• 내부 reasoning 태그(<think>, <sensitive> 등) 노출 금지\n• 불필요한 기술 용어 남용\n• 길고 복잡한 문장\n\n\n\uD83D\uDCD6 답변 구조 예시\n───────────────────────────────────\n1. 직관적 요약 (1-2문장)\n   → "T-검정은 두 그룹의 평균 차이를 비교하는 방법입니다"\n\n2. 상세 설명 (마크다운으로 정리)\n   → ## 언제 사용할까?\n   → ## 단계별 진행법\n\n3. 실무 팁 또는 주의사항\n   → "\uD83D\uDCA1 팁: 사전에 정규성 검정을 하면 더 정확합니다"',"\n\n").concat(e,"\n\n사용자 질문: ").concat(t,"\n\n답변:"),r=await fetch("".concat(this.ollamaEndpoint,"/api/generate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:this.inferenceModel,prompt:n,stream:!1,options:{temperature:.7,top_p:.9,num_predict:3e3}})});if(!r.ok)throw Error("응답 생성 실패: ".concat(r.statusText));let i=(await r.json()).response.trim();return(i=(i=(i=(i=i.replace(/<think>[\s\S]*?<\/think>/gi,"")).replace(/&lt;think&gt;[\s\S]*?&lt;\/think&gt;/gi,"")).replace(/-?sensitive\s*<think>[\s\S]*?<\/think>/gi,"")).replace(/^-?sensitive\s*/im,"")).trim()}async *streamGenerateAnswer(e,t){var n;let r="".concat('당신은 통계 분석 분야의 경험 많은 튜터입니다.\n아래 제공된 한국 통계 교육 자료를 바탕으로, 사용자의 질문에 명확하고 친근하게 답변해주세요.\n\n\n\uD83D\uDCDA 콘텐츠 참고 방식\n───────────────────────────────────\n• 제공된 자료를 최우선으로 활용하되, 관련 없으면 자유롭게 설명\n• 자료에 없는 내용은 "문서에 따르면..." 또는 "일반적으로..." 로 구분\n\n\n\uD83D\uDCAC 답변 스타일 가이드\n───────────────────────────────────\n• 마크다운으로 구조화하기: 제목(##), 리스트(-), 강조(**) 활용\n  예) "## T-검정이란?", "- 가정 1:", "**주의사항**"\n\n• 용어는 한글+영문 함께 표기\n  예) "귀무가설(Null Hypothesis)", "1종 오류(Type I Error)"\n\n• 결론 먼저 → 상세 설명 순서로\n  예) "네, 정규성 검정은 필수입니다. 이유는..."\n\n• 조건/주의사항은 명확하게 표시\n  예) "⚠️ 이 방법은 샘플이 30개 이상일 때만 권장합니다"\n\n\n\uD83D\uDEAB 피해야 할 것\n───────────────────────────────────\n• 내부 reasoning 태그(<think>, <sensitive> 등) 노출 금지\n• 불필요한 기술 용어 남용\n• 길고 복잡한 문장\n\n\n\uD83D\uDCD6 답변 구조 예시\n───────────────────────────────────\n1. 직관적 요약 (1-2문장)\n   → "T-검정은 두 그룹의 평균 차이를 비교하는 방법입니다"\n\n2. 상세 설명 (마크다운으로 정리)\n   → ## 언제 사용할까?\n   → ## 단계별 진행법\n\n3. 실무 팁 또는 주의사항\n   → "\uD83D\uDCA1 팁: 사전에 정규성 검정을 하면 더 정확합니다"',"\n\n").concat(e,"\n\n사용자 질문: ").concat(t,"\n\n답변:"),i=await fetch("".concat(this.ollamaEndpoint,"/api/generate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:this.inferenceModel,prompt:r,stream:!0,options:{temperature:.7,top_p:.9,num_predict:3e3}})});if(!i.ok)throw Error("응답 생성 실패: ".concat(i.statusText));let o=null==(n=i.body)?void 0:n.getReader();if(!o)throw Error("응답 스트림을 읽을 수 없습니다");let a=new TextDecoder,s="";try{for(;;){let{done:e,value:t}=await o.read();if(e)break;let n=(s+=a.decode(t,{stream:!0})).split("\n");for(let e of(s=n.pop()||"",n))if(""!==e.trim())try{let t=JSON.parse(e);if(t.response){let e=t.response;(e=(e=(e=(e=e.replace(/<think>[\s\S]*?<\/think>/gi,"")).replace(/&lt;think&gt;[\s\S]*?&lt;\/think&gt;/gi,"")).replace(/-?sensitive\s*<think>[\s\S]*?<\/think>/gi,"")).replace(/^-?sensitive\s*/im,""))&&(yield e)}}catch(e){}}if(s.trim())try{let e=JSON.parse(s);if(e.response){let t=e.response;(t=(t=(t=(t=t.replace(/<think>[\s\S]*?<\/think>/gi,"")).replace(/&lt;think&gt;[\s\S]*?&lt;\/think&gt;/gi,"")).replace(/-?sensitive\s*<think>[\s\S]*?<\/think>/gi,"")).replace(/^-?sensitive\s*/im,""))&&(yield t)}}catch(e){}}finally{o.releaseLock()}}constructor(e){super(e),this.isInitialized=!1,this.db=null,this.documents=[],this.ollamaEndpoint=e.ollamaEndpoint||"http://localhost:11434",this.embeddingModel=e.embeddingModel||"",this.inferenceModel=e.inferenceModel||"",this.vectorDbPath=e.vectorDbPath||"/rag-data/rag.db",this.topK=e.topK||5,this.testMode=e.testMode||!1}}var d=n(95704);class u{static getInstance(){return u.instance||(u.instance=new u),u.instance}async initialize(e){var t;if(this.provider&&e&&(e.vectorStoreId!==this.config.vectorStoreId||e.embeddingModel!==this.config.embeddingModel||e.inferenceModel!==this.config.inferenceModel)&&(await this.provider.cleanup(),this.provider=null),this.provider)return;e&&(this.config={...this.config,...e});let n=this.config.vectorDbPath||d.env.NEXT_PUBLIC_VECTOR_DB_PATH;this.config.vectorStoreId?(t=this.config.vectorStoreId,n="/rag-data/vector-".concat(t,".db")):this.config.vectorDbPath,this.provider=new l({name:"Ollama (Local)",ollamaEndpoint:this.config.ollamaEndpoint||d.env.NEXT_PUBLIC_OLLAMA_ENDPOINT||"http://localhost:11434",embeddingModel:this.config.embeddingModel||d.env.NEXT_PUBLIC_OLLAMA_EMBEDDING_MODEL,inferenceModel:this.config.inferenceModel||d.env.NEXT_PUBLIC_OLLAMA_INFERENCE_MODEL,vectorDbPath:n||"/rag-data/rag.db",topK:this.config.topK||parseInt(d.env.NEXT_PUBLIC_TOP_K||"5"),testMode:!1}),await this.provider.initialize()}async isReady(){return!!this.provider&&this.provider.isReady()}async query(e){if(!this.provider)throw Error("RAGService가 초기화되지 않았습니다. initialize()를 먼저 호출하세요.");if(!await this.provider.isReady())throw Error("Provider가 준비되지 않았습니다");return this.provider.query(e)}getProviderType(){return this.providerType}async rebuildDatabase(){this.provider&&(await this.provider.cleanup(),this.provider=null),await this.initialize()}async shutdown(){this.provider&&(await this.provider.cleanup(),this.provider=null),u.instance=null}constructor(){this.provider=null,this.config={},this.providerType="ollama"}}async function h(e){let t=u.getInstance();if(!await t.isReady()){let e=d.env.NEXT_PUBLIC_VECTOR_STORE_ID||"qwen3-embedding-0.6b";await t.initialize({vectorStoreId:e})}return t.query(e)}async function m(){try{let e=await fetch("/rag-data/vector-stores.json");if(!e.ok)return[];return await e.json()}catch(e){return[]}}u.instance=null},67001:(e,t,n)=>{n.d(t,{T:()=>o});var r=n(95155);n(12115);var i=n(25016);function o(e){let{className:t,...n}=e;return(0,r.jsx)("textarea",{"data-slot":"textarea",className:(0,i.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...n})}},67812:(e,t,n)=>{n.d(t,{E:()=>c});var r=n(95155);n(12115);var i=n(32467),o=n(83101),a=n(25016);let s=(0,o.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",success:"border-transparent bg-green-500 text-white [a&]:hover:bg-green-600 dark:bg-green-600 dark:[a&]:hover:bg-green-700",warning:"border-transparent bg-yellow-500 text-white [a&]:hover:bg-yellow-600 dark:bg-yellow-600 dark:[a&]:hover:bg-yellow-700"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:n,asChild:o=!1,...c}=e,l=o?i.DX:"span";return(0,r.jsx)(l,{"data-slot":"badge",className:(0,a.cn)(s({variant:n}),t),...c})}},83209:(e,t,n)=>{n.d(t,{BT:()=>c,Wu:()=>l,ZB:()=>s,Zp:()=>o,aR:()=>a});var r=n(95155);n(12115);var i=n(25016);function o(e){let{className:t,...n}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,i.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...n})}function a(e){let{className:t,...n}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,i.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...n})}function s(e){let{className:t,...n}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,i.cn)("leading-none font-semibold",t),...n})}function c(e){let{className:t,...n}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,i.cn)("text-muted-foreground text-sm",t),...n})}function l(e){let{className:t,...n}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,i.cn)("px-6",t),...n})}},97003:(e,t,n)=>{n.d(t,{$:()=>c,r:()=>s});var r=n(95155);n(12115);var i=n(32467),o=n(83101),a=n(25016);let s=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function c(e){let{className:t,variant:n,size:o,asChild:c=!1,...l}=e,d=c?i.DX:"button";return(0,r.jsx)(d,{"data-slot":"button",className:(0,a.cn)(s({variant:n,size:o,className:t})),...l})}}}]);