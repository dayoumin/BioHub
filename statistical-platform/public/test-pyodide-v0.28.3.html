<!DOCTYPE html>
<html>
<head>
    <title>Pyodide v0.28.3 νΈν™μ„± ν…μ¤νΈ</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.28.3/full/pyodide.js"></script>
</head>
<body>
    <h1>Pyodide v0.28.3 νΈν™μ„± ν…μ¤νΈ</h1>
    <pre id="output">λ΅λ”© μ¤‘...</pre>

    <script>
        async function main() {
            const output = document.getElementById('output');
            output.textContent = 'Pyodide λ΅λ”© μ¤‘...\n';

            try {
                // Pyodide λ΅λ“
                const pyodide = await loadPyodide({
                    indexURL: 'https://cdn.jsdelivr.net/pyodide/v0.28.3/full/'
                });
                output.textContent += 'β… Pyodide v0.28.3 λ΅λ“ μ„±κ³µ\n';

                // NumPy, SciPy λ΅λ“
                output.textContent += 'NumPy, SciPy, statsmodels λ΅λ”© μ¤‘...\n';
                await pyodide.loadPackage(['numpy', 'scipy', 'pandas', 'statsmodels']);
                output.textContent += 'β… ν¨ν‚¤μ§€ λ΅λ“ μ„±κ³µ\n\n';

                // λ²„μ „ ν™•μΈ
                const versions = await pyodide.runPythonAsync(`
import json
import numpy as np
import scipy
import pandas as pd
import statsmodels

versions = {
    'numpy': np.__version__,
    'scipy': scipy.__version__,
    'pandas': pd.__version__,
    'statsmodels': statsmodels.__version__
}
json.dumps(versions)
                `);

                const versionData = JSON.parse(versions);
                output.textContent += 'π“¦ ν¨ν‚¤μ§€ λ²„μ „:\n';
                output.textContent += `- NumPy: ${versionData.numpy}\n`;
                output.textContent += `- SciPy: ${versionData.scipy}\n`;
                output.textContent += `- Pandas: ${versionData.pandas}\n`;
                output.textContent += `- statsmodels: ${versionData.statsmodels}\n\n`;

                // Worker 2 partial_correlation ν…μ¤νΈ
                output.textContent += 'Worker 2 (partial_correlation) ν…μ¤νΈ μ¤‘...\n';

                const worker2Response = await fetch('/workers/python/worker2-hypothesis.py');
                const worker2Code = await worker2Response.text();
                await pyodide.runPythonAsync(worker2Code);

                const partialCorrTest = await pyodide.runPythonAsync(`
import json
import numpy as np

# ν…μ¤νΈ λ°μ΄ν„° μƒμ„±
np.random.seed(42)
n = 50
Z1 = np.random.randn(n)
X = 0.8 * Z1 + 0.2 * np.random.randn(n)
Y = 0.7 * Z1 + 0.3 * np.random.randn(n)

# λ°μ΄ν„° ν–‰λ ¬ κµ¬μ„±
data_matrix = np.column_stack([X, Y, Z1])

# partial_correlation μ‹¤ν–‰
result = partial_correlation(data_matrix, 0, 1, [2])
json.dumps(result)
                `);

                const partialCorrResult = JSON.parse(partialCorrTest);
                output.textContent += 'β… partial_correlation ν…μ¤νΈ μ„±κ³µ!\n';
                output.textContent += `- Correlation: ${partialCorrResult.correlation.toFixed(4)}\n`;
                output.textContent += `- p-value: ${partialCorrResult.pValue.toFixed(4)}\n`;
                output.textContent += `- df: ${partialCorrResult.df}\n`;
                output.textContent += `- n: ${partialCorrResult.nObservations}\n`;
                output.textContent += `- CI: [${partialCorrResult.confidenceInterval.lower.toFixed(4)}, ${partialCorrResult.confidenceInterval.upper.toFixed(4)}]\n\n`;

                // Worker 4 PCA ν…μ¤νΈ (NumPy 2.x SVD)
                output.textContent += 'Worker 4 (PCA with NumPy SVD) ν…μ¤νΈ μ¤‘...\n';

                const worker4Response = await fetch('/workers/python/worker4-regression-advanced.py');
                const worker4Code = await worker4Response.text();
                await pyodide.runPythonAsync(worker4Code);

                const pcaTest = await pyodide.runPythonAsync(`
import json
data = [[1, 2, 3], [2, 3, 4], [3, 4, 5], [4, 5, 6]]
result = pca_analysis(data, n_components=2)
json.dumps(result)
                `);

                const pcaResult = JSON.parse(pcaTest);
                output.textContent += 'β… PCA (NumPy 2.2.5 SVD) ν…μ¤νΈ μ„±κ³µ!\n';
                output.textContent += `- Components: ${pcaResult.components.length}x${pcaResult.components[0].length}\n`;
                output.textContent += `- Explained Variance: ${pcaResult.explainedVarianceRatio.map(v => v.toFixed(3)).join(', ')}\n\n`;

                output.textContent += 'π‰ λ¨λ“  ν…μ¤νΈ μ„±κ³µ! Pyodide v0.28.3 νΈν™μ„± ν™•μΈ μ™„λ£!\n';

            } catch (error) {
                output.textContent += `\nβ μ—λ¬ λ°μƒ:\n${error}\n${error.stack}`;
            }
        }

        main();
    </script>
</body>
</html>