#!/bin/bash

# í†µê³„ í˜ì´ì§€ ë©”íƒ€ë°ì´í„° ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸
# ì‘ì„±: 2025-11-05

STATS_DIR="app/(dashboard)/statistics"

echo "================================================================================
ğŸ“Š í†µê³„ í˜ì´ì§€ ë©”íƒ€ë°ì´í„° ë¶„ì„ ë¦¬í¬íŠ¸
================================================================================
"

echo "1ï¸âƒ£  ì „ì²´ í†µê³„"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
TOTAL=$(find "$STATS_DIR" -name "page.tsx" -not -path "*__tests__*" | wc -l)
WITH_VAR=$(find "$STATS_DIR" -name "page.tsx" -not -path "*__tests__*" -exec grep -l "VariableSelector" {} \; | wc -l)
WITH_STEPS=$(find "$STATS_DIR" -name "page.tsx" -not -path "*__tests__*" -exec grep -l "const steps" {} \; | wc -l)
WITH_OPTIONS=$(find "$STATS_DIR" -name "page.tsx" -not -path "*__tests__*" -exec grep -l "ì˜µì…˜ ì„¤ì •\|OptionsCard" {} \; | wc -l)

echo "ì´ í˜ì´ì§€: $TOTALê°œ"
echo "VariableSelector ì‚¬ìš©: $WITH_VARê°œ ($(awk "BEGIN {printf \"%.0f\", $WITH_VAR * 100 / $TOTAL}")%)"
echo "Steps êµ¬í˜„: $WITH_STEPSê°œ ($(awk "BEGIN {printf \"%.0f\", $WITH_STEPS * 100 / $TOTAL}")%)"
echo "ì˜µì…˜ ì¹´ë“œ êµ¬í˜„: $WITH_OPTIONSê°œ ($(awk "BEGIN {printf \"%.0f\", $WITH_OPTIONS * 100 / $TOTAL}")%)"
echo ""

echo "2ï¸âƒ£  VariableSelector ë¯¸ì‚¬ìš© í˜ì´ì§€ (5ê°œ)"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
find "$STATS_DIR" -name "page.tsx" -not -path "*__tests__*" | while read file; do
  if ! grep -q "VariableSelector" "$file"; then
    basename $(dirname "$file")
  fi
done
echo ""

echo "3ï¸âƒ£  Steps ë¯¸êµ¬í˜„ í˜ì´ì§€"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
NO_STEPS=$(find "$STATS_DIR" -name "page.tsx" -not -path "*__tests__*" | while read file; do
  if ! grep -q "const steps" "$file"; then
    basename $(dirname "$file")
  fi
done)

if [ -z "$NO_STEPS" ]; then
  echo "âœ… ëª¨ë“  í˜ì´ì§€ì— Steps êµ¬í˜„ë¨!"
else
  echo "$NO_STEPS"
fi
echo ""

echo "4ï¸âƒ£  ì˜µì…˜ ì¹´ë“œ êµ¬í˜„ í˜ì´ì§€ ëª©ë¡"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
find "$STATS_DIR" -name "page.tsx" -not -path "*__tests__*" -exec grep -l "ì˜µì…˜ ì„¤ì •\|OptionsCard" {} \; | while read file; do
  echo "  âœ“ $(basename $(dirname "$file"))"
done
echo ""

echo "5ï¸âƒ£  methodId ëª©ë¡ (ìƒìœ„ 20ê°œ)"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
find "$STATS_DIR" -name "page.tsx" -not -path "*__tests__*" -exec grep -oP 'methodId=["'"'"']?\K[^"'"'"' }]+' {} \; | head -20 | while read mid; do
  echo "  - $mid"
done
echo ""

echo "================================================================================
âœ… ë¶„ì„ ì™„ë£Œ
================================================================================
"
