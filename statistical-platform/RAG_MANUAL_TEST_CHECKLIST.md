# RAG ì‹œìŠ¤í…œ ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ë‚ ì§œ**: 2025-11-04
**ê°œë°œ ì„œë²„**: http://localhost:3006
**Jest ìƒíƒœ**: `rag-assistant.test.tsx` ë° `math-rendering.test.tsx`ê°€ `jest.config.js`ì—ì„œ ì˜ë„ì ìœ¼ë¡œ ì œì™¸ë¨
**í…ŒìŠ¤íŠ¸ ë°©ë²•**: ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì‹¤í–‰ + ì½˜ì†” í™•ì¸

---

## ğŸ“Š í…ŒìŠ¤íŠ¸ í˜„í™© ìš”ì•½

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| **TypeScript ì»´íŒŒì¼** | âœ… 0 errors | ì™„ë²½ |
| **ê°œë°œ ì„œë²„** | âœ… ì‹¤í–‰ ì¤‘ | Port 3006 |
| **Jest í…ŒìŠ¤íŠ¸** | âš ï¸ ì œì™¸ë¨ | `testPathIgnorePatterns` ì„¤ì • |
| **ìˆ˜ë™ í…ŒìŠ¤íŠ¸** | â¬œï¸ ì§„í–‰ ì˜ˆì • | ì´ ë¬¸ì„œ |

---

## ğŸ¯ í…ŒìŠ¤íŠ¸ í˜ì´ì§€

### 1ï¸âƒ£ RAG í…ŒìŠ¤íŠ¸ í˜ì´ì§€ (ê°œë°œìš©)
**URL**: http://localhost:3006/rag-test
**ëª©ì **: Vector Store ê¸°ë°˜ RAG ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸

### 2ï¸âƒ£ AI ì±—ë´‡ í˜ì´ì§€ (í”„ë¡œë•ì…˜)
**URL**: http://localhost:3006/chatbot
**ëª©ì **: Grok ìŠ¤íƒ€ì¼ ì‚¬ì´ë“œë°” + ì„¸ì…˜ ê´€ë¦¬ + RAG í†µí•©

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### **Scenario 1: RAG í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ê¸°ë³¸ ë™ì‘**

#### **1-A. í˜ì´ì§€ ë¡œë“œ**
- [ ] í˜ì´ì§€ê°€ ì •ìƒ ë Œë”ë§ë¨
- [ ] "í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬" íƒ­ê³¼ "Vector Store ê´€ë¦¬" íƒ­ í‘œì‹œ
- [ ] ì½˜ì†” ì—ëŸ¬ ì—†ìŒ

#### **1-B. ëª¨ë¸ ì„¤ì •**
- [ ] "Refresh Models" ë²„íŠ¼ í´ë¦­ â†’ Ollama ëª¨ë¸ ëª©ë¡ ë¡œë“œ
- [ ] Vector Store ë“œë¡­ë‹¤ìš´ì—ì„œ ì„ íƒ ê°€ëŠ¥
- [ ] Embedding Model ë“œë¡­ë‹¤ìš´ ì‘ë™
- [ ] Inference Model ë“œë¡­ë‹¤ìš´ ì‘ë™
- [ ] Search Mode ì„ íƒ (semantic/keyword/hybrid)

**ì˜ˆìƒ ë™ì‘**:
- Ollama ì„œë²„ (http://localhost:11434) ì—°ê²° ì„±ê³µ
- ëª¨ë¸ ëª©ë¡ í‘œì‹œ (ì˜ˆ: `mxbai-embed-large`, `qwen3:4b`)

**ì—ëŸ¬ ì‹œ í™•ì¸**:
```bash
# Ollama ì„œë²„ ì‹¤í–‰ í™•ì¸
curl http://localhost:11434/api/tags
```

#### **1-C. ì¿¼ë¦¬ ì‹¤í–‰**
- [ ] ì§ˆë¬¸ ì…ë ¥: "t-testì™€ ANOVAì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì¸ê°€ìš”?"
- [ ] "ì¿¼ë¦¬ ì‹¤í–‰" ë²„íŠ¼ í´ë¦­
- [ ] ë¡œë”© ìƒíƒœ í‘œì‹œ (Spinner)
- [ ] ì‘ë‹µ í‘œì‹œ
- [ ] ì°¸ì¡° ë¬¸ì„œ ëª©ë¡ í‘œì‹œ (Sources)
- [ ] Score ê°’ í‘œì‹œ (0~1)

**ì˜ˆìƒ ê²°ê³¼**:
- ì‘ë‹µ ì‹œê°„: ~2-5ì´ˆ
- ì°¸ì¡° ë¬¸ì„œ ê°œìˆ˜: 3-5ê°œ
- ì‘ë‹µ í˜•ì‹: Markdown (ë‹¨ë½, ë¶ˆë › í¬ì¸íŠ¸ ë“±)

**ì—ëŸ¬ ì²´í¬**:
- [ ] ì½˜ì†”ì— ì—ëŸ¬ ë©”ì‹œì§€ ì—†ìŒ
- [ ] ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ Ollama API í˜¸ì¶œ ì„±ê³µ (200)

#### **1-D. Vector Store ê´€ë¦¬**
- [ ] "Vector Store ê´€ë¦¬" íƒ­ í´ë¦­
- [ ] "ì •ë³´" íƒ­: í˜„ì¬ Vector Store ì •ë³´ í‘œì‹œ
  - ì´ë¦„, ì„ë² ë”© ëª¨ë¸, ë¬¸ì„œ ìˆ˜, ì°¨ì›, DB í¬ê¸°, ê²½ë¡œ
- [ ] "ë¹Œë“œ" íƒ­: ë¹Œë“œ ëª…ë ¹ì–´ ì•ˆë‚´
- [ ] "ëª…ë ¹ì–´ ë³µì‚¬" ë²„íŠ¼ â†’ í´ë¦½ë³´ë“œ ë³µì‚¬

---

### **Scenario 2: AI ì±—ë´‡ í˜ì´ì§€ (í”„ë¡œë•ì…˜)**

#### **2-A. í˜ì´ì§€ ë¡œë“œ + ì‚¬ì´ë“œë°”**
- [ ] í˜ì´ì§€ ì •ìƒ ë Œë”ë§
- [ ] ì‚¬ì´ë“œë°” í‘œì‹œ (ì™¼ìª½)
- [ ] "ìƒˆ ëŒ€í™”" ë²„íŠ¼ í‘œì‹œ
- [ ] ê²€ìƒ‰ì°½ í‘œì‹œ
- [ ] ì¦ê²¨ì°¾ê¸°, í”„ë¡œì íŠ¸, íˆìŠ¤í† ë¦¬ ì„¹ì…˜ í‘œì‹œ
- [ ] ì½˜ì†” ì—ëŸ¬ ì—†ìŒ

#### **2-B. ì„¸ì…˜ ê´€ë¦¬**
- [ ] "ìƒˆ ëŒ€í™”" ë²„íŠ¼ í´ë¦­ â†’ ìƒˆ ì„¸ì…˜ ìƒì„±
- [ ] ì„¸ì…˜ ëª©ë¡ì— "ìƒˆ ëŒ€í™”" ì¶”ê°€ë¨
- [ ] ì„¸ì…˜ í´ë¦­ â†’ ì±„íŒ… ì˜ì—­ ë¡œë“œ
- [ ] 3ì  ë©”ë‰´ í´ë¦­ â†’ ì˜µì…˜ í‘œì‹œ
  - [ ] ì¦ê²¨ì°¾ê¸° ì¶”ê°€/í•´ì œ
  - [ ] ì´ë¦„ ë³€ê²½
  - [ ] í”„ë¡œì íŠ¸ ì´ë™
  - [ ] ì‚­ì œ

#### **2-C. RAG ì±—ë´‡ ëŒ€í™”**
- [ ] ì±„íŒ… ì…ë ¥ì°½ í‘œì‹œ
- [ ] ë¹ˆ ìƒíƒœì—ì„œ í€µ í”„ë¡¬í”„íŠ¸ í‘œì‹œ (4ê°œ)
- [ ] í€µ í”„ë¡¬í”„íŠ¸ í´ë¦­ â†’ ì§ˆë¬¸ ìë™ ì…ë ¥
- [ ] ë©”ì‹œì§€ ì „ì†¡ (Enter ë˜ëŠ” ë²„íŠ¼)
- [ ] AI ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë° (typewriter íš¨ê³¼)
- [ ] ì‘ë‹µ ì™„ë£Œ í›„ ì°¸ì¡° ë¬¸ì„œ í‘œì‹œ

**í…ŒìŠ¤íŠ¸ ì§ˆë¬¸**:
1. "t-testëŠ” ì–¸ì œ ì‚¬ìš©í•˜ë‚˜ìš”?"
2. "ANOVAì™€ íšŒê·€ë¶„ì„ì˜ ì°¨ì´ì ì€?"
3. "ì •ê·œì„± ê²€ì • ë°©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”"

**ì˜ˆìƒ ë™ì‘**:
- ê° ì‘ë‹µë§ˆë‹¤ ì°¸ì¡° ë¬¸ì„œ 3-5ê°œ
- ì‘ë‹µ ì‹œê°„: ~2-5ì´ˆ
- Markdown ë Œë”ë§ ì •ìƒ (ë³¼ë“œ, ë¶ˆë ›, ì½”ë“œ ë¸”ë¡ ë“±)

#### **2-D. ì„¸ì…˜ ì €ì¥ + ë¡œë“œ**
- [ ] ë©”ì‹œì§€ ì „ì†¡ í›„ ìƒˆë¡œê³ ì¹¨ (F5)
- [ ] ì„¸ì…˜ ëª©ë¡ì— ì´ì „ ëŒ€í™” í‘œì‹œ
- [ ] ì„¸ì…˜ í´ë¦­ â†’ ì´ì „ ë©”ì‹œì§€ ë¡œë“œ
- [ ] ë©”ì‹œì§€ ë‚´ìš© + ì°¸ì¡° ë¬¸ì„œ ëª¨ë‘ í‘œì‹œ
- [ ] IndexedDB ì €ì¥ í™•ì¸ (DevTools â†’ Application â†’ IndexedDB â†’ `chat-storage`)

#### **2-E. í”„ë¡œì íŠ¸ ê´€ë¦¬**
- [ ] "í”„ë¡œì íŠ¸ ì¶”ê°€" ë²„íŠ¼ í´ë¦­ (Projects ì„¹ì…˜)
- [ ] í”„ë¡œì íŠ¸ ì´ë¦„ ì…ë ¥ (ì˜ˆ: "í†µê³„ ë¶„ì„ ì—°êµ¬")
- [ ] í”„ë¡œì íŠ¸ ìƒì„±
- [ ] ì„¸ì…˜ 3ì  ë©”ë‰´ â†’ "í”„ë¡œì íŠ¸ ì´ë™" â†’ í”„ë¡œì íŠ¸ ì„ íƒ
- [ ] ì„¸ì…˜ì´ í”„ë¡œì íŠ¸ë¡œ ì´ë™ë¨
- [ ] í”„ë¡œì íŠ¸ í¼ì¹˜ê¸°/ì ‘ê¸° ë™ì‘ í™•ì¸

#### **2-F. ê²€ìƒ‰ ê¸°ëŠ¥**
- [ ] ê²€ìƒ‰ì°½ì— "t-test" ì…ë ¥
- [ ] ì„¸ì…˜ í•„í„°ë§ (ì œëª© ì¼ì¹˜)
- [ ] í”„ë¡œì íŠ¸ í•„í„°ë§
- [ ] ê²€ìƒ‰ ê²°ê³¼ í•˜ì´ë¼ì´íŠ¸
- [ ] ê²€ìƒ‰ ì´ˆê¸°í™” (X ë²„íŠ¼)

#### **2-G. í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤**
- [ ] `Ctrl + N` â†’ ìƒˆ ëŒ€í™” ìƒì„±
- [ ] ì„¸ì…˜ ì´ë¦„ ë³€ê²½ ì‹œ `Enter` â†’ ì €ì¥
- [ ] ì„¸ì…˜ ì´ë¦„ ë³€ê²½ ì‹œ `Escape` â†’ ì·¨ì†Œ

---

## ğŸ› ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸

### **E-1. Ollama ì„œë²„ ì—°ê²° ì‹¤íŒ¨**
**ì‹œë‚˜ë¦¬ì˜¤**: Ollama ì„œë²„ê°€ êº¼ì ¸ ìˆì„ ë•Œ
- [ ] "Ollama ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
- [ ] ì•±ì´ í¬ë˜ì‹œí•˜ì§€ ì•ŠìŒ
- [ ] ì„œë²„ ì¬ì‹œì‘ í›„ ë³µêµ¬ ê°€ëŠ¥

### **E-2. Vector Store ì—†ìŒ**
**ì‹œë‚˜ë¦¬ì˜¤**: `public/rag-data/` í´ë”ì— DB íŒŒì¼ ì—†ì„ ë•Œ
- [ ] "Vector Store ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ë©”ì‹œì§€ (ë˜ëŠ” ë¹ˆ ëª©ë¡)
- [ ] ì¿¼ë¦¬ ì‹¤í–‰ ì‹œ ì—ëŸ¬ í•¸ë“¤ë§

### **E-3. ë¹ˆ ì§ˆë¬¸ ì „ì†¡**
- [ ] ì…ë ¥ì°½ì´ ë¹„ì–´ ìˆì„ ë•Œ ì „ì†¡ ë²„íŠ¼ ë¹„í™œì„±í™”
- [ ] ê³µë°±ë§Œ ì…ë ¥ ì‹œ "ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”" ì—ëŸ¬

### **E-4. ì„¸ì…˜ ì‚­ì œ í›„ ë³µêµ¬**
- [ ] ì„¸ì…˜ ì‚­ì œ â†’ í˜„ì¬ ì„¸ì…˜ì´ë©´ ìƒˆ ì„¸ì…˜ ìë™ ìƒì„±
- [ ] ë‹¤ë¥¸ ì„¸ì…˜ì´ë©´ í˜„ì¬ ì„¸ì…˜ ìœ ì§€

---

## ğŸ“‹ ë¹„ë™ê¸° íŒ¨í„´ ê²€ì¦ (ì½”ë“œ ë¦¬ë·°)

ì´ ë¶€ë¶„ì€ **rag-assistant.test.tsx**ê°€ ê²€ì¦í•˜ë ¤ë˜ ë‚´ìš©ì…ë‹ˆë‹¤.

### **âœ… useEffectì—ì„œ async/await íŒ¨í„´**
```typescript
// rag-assistant.tsx:57-77
useEffect(() => {
  const loadSessions = async () => {
    try {
      const loadedSessions = await ChatStorageIndexedDB.loadSessions()
      setSessions(loadedSessions)
      // ...
    } catch (err) {
      console.error('Failed to load sessions:', err)
    }
  }

  void loadSessions() // âœ… async í•¨ìˆ˜ í˜¸ì¶œ
}, [])
```

### **âœ… useCallback + async ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬**
```typescript
// rag-assistant.tsx:148-199
const handleSubmit = useCallback(async () => {
  if (!query.trim() || !currentSessionId) return

  setIsLoading(true)
  setError(null)

  try {
    const response = await queryRAG({ query: query.trim(), method })
    // ...
    await ChatStorageIndexedDB.addMessage(...)
  } catch (err) {
    const errorResult = handleRAGError(err, 'RAGAssistant.handleSubmit')
    setError(errorResult.message)
  } finally {
    setIsLoading(false)
  }
}, [query, currentSessionId, method, onNewMessage])
```

### **ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] `useEffect`ì—ì„œ IIFE íŒ¨í„´ ì‚¬ìš© (`async () => { ... }()` ë˜ëŠ” `void loadSessions()`)
- [ ] ëª¨ë“  async í•¨ìˆ˜ì— `try-catch` ì—ëŸ¬ ì²˜ë¦¬
- [ ] `finally` ë¸”ë¡ì—ì„œ ë¡œë”© ìƒíƒœ í•´ì œ
- [ ] `useCallback` ì˜ì¡´ì„± ë°°ì—´ ì •í™•í•¨

---

## ğŸ” TypeScript íƒ€ì… ì•ˆì „ì„± ì²´í¬

### **âœ… any íƒ€ì… ì‚¬ìš© ê¸ˆì§€**
```bash
# ì „ì²´ í”„ë¡œì íŠ¸ì—ì„œ any ê²€ìƒ‰
cd statistical-platform
grep -rn ": any" components/rag/ lib/rag/ lib/services/storage/ --include="*.ts" --include="*.tsx"
```

**ì˜ˆìƒ ê²°ê³¼**: 0ê°œ (ë˜ëŠ” ëª…ì‹œì  anyë§Œ)

### **âœ… íƒ€ì… ê°€ë“œ ì‚¬ìš©**
```typescript
// rag-test/page.tsx:116-128
if (err instanceof Error) {
  errorMessage = err.message
} else if (typeof err === 'string') {
  errorMessage = err
} else if (err && typeof err === 'object') {
  errorMessage = 'Ollama ì„œë²„ ì—°ê²° ì‹¤íŒ¨'
}
```

---

## ğŸ“Š ì„±ëŠ¥ ê²€ì¦

### **P-1. Vector Store ê²€ìƒ‰ ì†ë„**
**ëª©í‘œ**: 50ms ì´í•˜ (ì‚¬ì „ ìƒì„±ëœ ì„ë² ë”©)

**ì¸¡ì • ë°©ë²•**:
1. ê°œë°œì ë„êµ¬ â†’ Network íƒ­
2. ì¿¼ë¦¬ ì‹¤í–‰
3. `vector-search` API í˜¸ì¶œ ì‹œê°„ í™•ì¸

### **P-2. Ollama ì¶”ë¡  ì†ë„**
**ëª©í‘œ**: 2-5ì´ˆ (ëª¨ë¸ í¬ê¸°ì— ë”°ë¼)

**ì¸¡ì • ë°©ë²•**:
1. ì½˜ì†”ì—ì„œ `response.metadata.responseTime` í™•ì¸
2. ë˜ëŠ” Network íƒ­ì—ì„œ `/api/generate` í˜¸ì¶œ ì‹œê°„

### **P-3. IndexedDB ì €ì¥ ì†ë„**
**ëª©í‘œ**: 100ms ì´í•˜

**ì¸¡ì • ë°©ë²•**:
```javascript
// ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì‹¤í–‰
console.time('save')
await ChatStorageIndexedDB.addMessage(sessionId, message)
console.timeEnd('save')
```

---

## ğŸ¯ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### **ê¸°ëŠ¥ ì™„ì„±ë„**
- [ ] RAG ì¿¼ë¦¬ ì‹¤í–‰
- [ ] ì°¸ì¡° ë¬¸ì„œ í‘œì‹œ
- [ ] ì„¸ì…˜ ìƒì„±/ë¡œë“œ/ì €ì¥/ì‚­ì œ
- [ ] í”„ë¡œì íŠ¸ ê´€ë¦¬
- [ ] ê²€ìƒ‰ ê¸°ëŠ¥
- [ ] ì¦ê²¨ì°¾ê¸°
- [ ] í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤

### **ì½”ë“œ í’ˆì§ˆ**
- [ ] TypeScript 0 ì—ëŸ¬
- [ ] `any` íƒ€ì… ì‚¬ìš© ê¸ˆì§€
- [ ] async/await íŒ¨í„´ ì‚¬ìš©
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ì™„ë²½
- [ ] ì½˜ì†” ì—ëŸ¬ ì—†ìŒ

### **ì‚¬ìš©ì ê²½í—˜**
- [ ] ë¡œë”© ìƒíƒœ ëª…í™•
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ ì¹œí™”ì 
- [ ] UI ë°˜ì‘ì„± ì¢‹ìŒ
- [ ] í€µ í”„ë¡¬í”„íŠ¸ ìœ ìš©í•¨

---

## ğŸ“ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ê¸°ë¡

### **ë°œê²¬ëœ ë²„ê·¸**
| # | í˜ì´ì§€ | ì¦ìƒ | ì¬í˜„ | ì‹¬ê°ë„ | ìƒíƒœ |
|---|--------|------|------|--------|------|
| (ì˜ˆì •) | | | | | â¬œï¸ |

### **ì„±ëŠ¥ ì´ìŠˆ**
| # | í•­ëª© | ì¸¡ì •ê°’ | ëª©í‘œê°’ | ìƒíƒœ |
|---|------|--------|--------|------|
| (ì˜ˆì •) | | | | â¬œï¸ |

### **ê°œì„  ì œì•ˆ**
- (ì˜ˆì •)

---

## ğŸ“Œ ë‹¤ìŒ ë‹¨ê³„

1. **ì¦‰ì‹œ**: ìœ„ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ (30ë¶„ ì˜ˆìƒ)
2. **jest.config.js ìˆ˜ì • ê³ ë ¤**:
   - RAG í…ŒìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ í™œì„±í™”í• ì§€ ê²°ì •
   - ë˜ëŠ” E2E í…ŒìŠ¤íŠ¸ë¡œ ì „í™˜ (Playwright ë“±)
3. **ê²°ê³¼ ì •ë¦¬**: ë²„ê·¸ ë°œê²¬ ì‹œ GitHub Issue ìƒì„±

---

**ì‘ì„±ì**: Claude Code
**ìƒíƒœ**: ì§„í–‰ ëŒ€ê¸° ğŸ”„
**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 30ë¶„

---

## ğŸ”— ì°¸ê³  ë¬¸ì„œ

- [jest.config.js](./jest.config.js) - í…ŒìŠ¤íŠ¸ ì œì™¸ ì„¤ì •
- [components/rag/rag-assistant.tsx](./components/rag/rag-assistant.tsx) - RAG ì–´ì‹œìŠ¤í„´íŠ¸ (267ì¤„)
- [app/rag-test/page.tsx](./app/rag-test/page.tsx) - ê°œë°œìš© í…ŒìŠ¤íŠ¸ í˜ì´ì§€ (593ì¤„)
- [app/chatbot/page.tsx](./app/chatbot/page.tsx) - í”„ë¡œë•ì…˜ ì±—ë´‡ (512ì¤„)
- [__tests__/rag-assistant.test.tsx](./components/rag/__tests__/rag-assistant.test.tsx) - ì œì™¸ëœ ìë™ í…ŒìŠ¤íŠ¸ (295ì¤„)
