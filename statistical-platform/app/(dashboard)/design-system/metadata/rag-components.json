{
  "id": "rag-components",
  "version": "1.0.0",
  "lastUpdated": "2025-11-24",
  "sources": [
    "statistical-platform/components/rag/",
    "statistical-platform/lib/rag/",
    "statistical-platform/docs/RAG_ARCHITECTURE.md"
  ],
  "categories": [
    {
      "name": "Core RAG Components",
      "description": "RAG ì‹œìŠ¤í…œ í•µì‹¬ ì»´í¬ë„ŒíŠ¸",
      "components": [
        {
          "name": "RAGAssistantCompact",
          "path": "components/rag/rag-assistant-compact.tsx",
          "purpose": "ìš°ì¸¡ íŒ¨ë„ ìµœì í™” RAG ì–´ì‹œìŠ¤í„´íŠ¸",
          "props": {
            "method": "string (ì„ íƒ) - í˜„ì¬ í†µê³„ ë©”ì„œë“œ",
            "className": "string (ì„ íƒ) - ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤"
          },
          "features": [
            "Perplexity ìŠ¤íƒ€ì¼ ì¸ë¼ì¸ ì¸ìš© [1], [2]",
            "ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ (íƒ€ì´í•‘ ì»¤ì„œ íš¨ê³¼)",
            "ì„¸ì…˜ ê¸°ë¡ ê´€ë¦¬ (IndexedDB)",
            "ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥",
            "ì†ŒìŠ¤ í‘œì‹œ (ì ‘ê¸°/í¼ì¹˜ê¸°)"
          ],
          "usage": "import { RAGAssistantCompact } from '@/components/rag/rag-assistant-compact';\n\n<RAGAssistantCompact method=\"tTest\" />"
        },
        {
          "name": "ChatSourcesDisplay",
          "path": "components/rag/chat-sources-display.tsx",
          "purpose": "RAG ì‘ë‹µ ì†ŒìŠ¤ í‘œì‹œ",
          "props": {
            "sources": "Source[] - ì¶œì²˜ ëª©ë¡",
            "isOpen": "boolean - í¼ì¹¨/ì ‘í˜ ìƒíƒœ",
            "onToggle": "() => void - í† ê¸€ í•¸ë“¤ëŸ¬"
          },
          "features": [
            "í˜ì´ì§€ ë²ˆí˜¸ í‘œì‹œ",
            "ìŠ¤ì½”ì–´ í‘œì‹œ (ê´€ë ¨ë„)",
            "ì ‘ê¸°/í¼ì¹˜ê¸° ì• ë‹ˆë©”ì´ì…˜"
          ],
          "usage": "<ChatSourcesDisplay\n  sources={response.sources}\n  isOpen={showSources}\n  onToggle={() => setShowSources(!showSources)}\n/>"
        },
        {
          "name": "SessionHistoryDropdown",
          "path": "components/rag/session-history-dropdown.tsx",
          "purpose": "ì„¸ì…˜ ê¸°ë¡ ë“œë¡­ë‹¤ìš´",
          "props": {
            "sessions": "ChatSession[] - ì„¸ì…˜ ëª©ë¡",
            "currentSessionId": "string | null - í˜„ì¬ ì„¸ì…˜ ID",
            "onSelectSession": "(id: string) => void - ì„¸ì…˜ ì„ íƒ í•¸ë“¤ëŸ¬",
            "onDeleteSession": "(id: string) => void - ì„¸ì…˜ ì‚­ì œ í•¸ë“¤ëŸ¬"
          },
          "features": [
            "ìµœê·¼ 10ê°œ ì„¸ì…˜ í‘œì‹œ",
            "ì„¸ì…˜ ì´ë¦„ í‘œì‹œ",
            "ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸"
          ],
          "usage": "<SessionHistoryDropdown\n  sessions={sessions}\n  currentSessionId={currentSessionId}\n  onSelectSession={handleSelect}\n  onDeleteSession={handleDelete}\n/>"
        }
      ]
    },
    {
      "name": "Setup & Configuration",
      "description": "RAG ì‹œìŠ¤í…œ ì„¤ì • ì»´í¬ë„ŒíŠ¸",
      "components": [
        {
          "name": "OllamaSetupDialog",
          "path": "components/chatbot/ollama-setup-dialog.tsx",
          "purpose": "Ollama ì„œë²„ ì„¤ì • ë‹¤ì´ì–¼ë¡œê·¸",
          "props": {
            "open": "boolean - ë‹¤ì´ì–¼ë¡œê·¸ ì—´ë¦¼ ìƒíƒœ",
            "onOpenChange": "(open: boolean) => void - ìƒíƒœ ë³€ê²½ í•¸ë“¤ëŸ¬",
            "onSuccess": "() => void - ì„¤ì • ì™„ë£Œ ì½œë°±"
          },
          "features": [
            "Ollama ì„œë²„ ìƒíƒœ ì²´í¬",
            "ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •",
            "ëª¨ë¸ ë‹¤ìš´ë¡œë“œ ê°€ì´ë“œ",
            "ì—°ê²° í…ŒìŠ¤íŠ¸"
          ],
          "usage": "<OllamaSetupDialog\n  open={showSetup}\n  onOpenChange={setShowSetup}\n  onSuccess={handleSuccess}\n/>"
        },
        {
          "name": "ModelSettings",
          "path": "components/rag/model-settings.tsx",
          "purpose": "RAG ëª¨ë¸ ì„¤ì • (ì˜¨ë„, í† í° ë“±)",
          "props": {
            "temperature": "number - ì˜¨ë„ (0.0-1.0)",
            "maxTokens": "number - ìµœëŒ€ í† í°",
            "onChange": "(settings) => void - ì„¤ì • ë³€ê²½ í•¸ë“¤ëŸ¬"
          },
          "features": [
            "ì˜¨ë„ ì¡°ì ˆ (ì°½ì˜ì„±)",
            "ìµœëŒ€ í† í° ì„¤ì •",
            "ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°"
          ],
          "usage": "<ModelSettings\n  temperature={0.7}\n  maxTokens={2000}\n  onChange={handleChange}\n/>"
        },
        {
          "name": "VectorStoreSelector",
          "path": "components/rag/vector-store-selector.tsx",
          "purpose": "Vector Store ì„ íƒê¸°",
          "props": {
            "selectedStore": "string - ì„ íƒëœ ìŠ¤í† ì–´ ID",
            "onSelect": "(id: string) => void - ì„ íƒ í•¸ë“¤ëŸ¬"
          },
          "features": [
            "ì‚¬ìš© ê°€ëŠ¥í•œ Vector Store ëª©ë¡",
            "ë¬¸ì„œ ê°œìˆ˜ í‘œì‹œ",
            "ê²€ìƒ‰ ë²”ìœ„ ì„¤ì •"
          ],
          "usage": "<VectorStoreSelector\n  selectedStore={currentStore}\n  onSelect={setCurrentStore}\n/>"
        }
      ]
    },
    {
      "name": "RAG Services",
      "description": "RAG ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ ë ˆì´ì–´",
      "services": [
        {
          "name": "queryRAGStream",
          "path": "lib/rag/rag-service.ts",
          "signature": "async function queryRAGStream(query: string, onChunk: (chunk: string) => void): Promise<RAGResponse>",
          "purpose": "ìŠ¤íŠ¸ë¦¬ë° RAG ì¿¼ë¦¬",
          "parameters": {
            "query": "ì‚¬ìš©ì ì§ˆë¬¸",
            "onChunk": "ìŠ¤íŠ¸ë¦¬ë° ì²­í¬ ì½œë°±"
          },
          "returns": "RAGResponse (answer, sources, metadata)",
          "example": "const response = await queryRAGStream(\n  'íŒë³„ë¶„ì„ì´ë€?',\n  (chunk) => setStreamingText(prev => prev + chunk)\n);"
        },
        {
          "name": "checkOllamaStatus",
          "path": "lib/rag/utils/ollama-check.ts",
          "signature": "async function checkOllamaStatus(endpoint: string): Promise<OllamaStatus>",
          "purpose": "Ollama ì„œë²„ ìƒíƒœ ì²´í¬",
          "parameters": {
            "endpoint": "Ollama ì„œë²„ URL"
          },
          "returns": "OllamaStatus (isAvailable, models, version)",
          "example": "const status = await checkOllamaStatus(\n  process.env.NEXT_PUBLIC_OLLAMA_ENDPOINT || 'http://localhost:11434'\n);"
        },
        {
          "name": "ChatStorageIndexedDB",
          "path": "lib/services/storage/chat-storage-indexed-db.ts",
          "signature": "class ChatStorageIndexedDB",
          "purpose": "IndexedDB ê¸°ë°˜ ì±„íŒ… ì„¸ì…˜ ì €ì¥ì†Œ",
          "methods": [
            "getSessions(): Promise<ChatSession[]>",
            "getSession(id: string): Promise<ChatSession | null>",
            "saveSession(session: ChatSession): Promise<void>",
            "deleteSession(id: string): Promise<void>"
          ],
          "example": "const storage = new ChatStorageIndexedDB();\nawait storage.initialize();\nconst sessions = await storage.getSessions();"
        }
      ]
    }
  ],
  "architecture": {
    "diagram": "ì‚¬ìš©ì â†’ RAGAssistantCompact â†’ queryRAGStream â†’ Ollama (ì„ë² ë”©) â†’ SQLite (ë²¡í„° ê²€ìƒ‰) â†’ Ollama (ë‹µë³€ ìƒì„±)",
    "layers": [
      {
        "name": "UI Layer",
        "components": ["RAGAssistantCompact", "ChatSourcesDisplay", "SessionHistoryDropdown"],
        "responsibility": "ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤, ì´ë²¤íŠ¸ ì²˜ë¦¬"
      },
      {
        "name": "Service Layer",
        "components": ["queryRAGStream", "checkOllamaStatus", "ChatStorageIndexedDB"],
        "responsibility": "ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ë°ì´í„° ì²˜ë¦¬"
      },
      {
        "name": "Infrastructure Layer",
        "components": ["sql.js", "absurd-sql", "Ollama"],
        "responsibility": "ë²¡í„° ê²€ìƒ‰, ì„ë² ë”©, LLM"
      }
    ]
  },
  "integrationPattern": {
    "name": "Chat Panel Integration (ì „ì—­ ì‚¬ìš©)",
    "location": "app/(dashboard)/layout.tsx",
    "code": "// Layout ë ˆë²¨ì—ì„œ ì „ì—­ í†µí•©\nimport { ChatPanel } from '@/components/chatbot/chat-panel';\n\nexport default function DashboardLayout({ children }) {\n  return (\n    <div className=\"flex\">\n      <Sidebar />\n      <main className=\"flex-1\">\n        <Header /> {/* MessageCircle ë²„íŠ¼ìœ¼ë¡œ ChatPanel ì—´ê¸° */}\n        {children}\n      </main>\n      <ChatPanel /> {/* ìš°ì¸¡ íŒ¨ë„, ë¦¬ì‚¬ì´ì§• ê°€ëŠ¥ */}\n    </div>\n  );\n}",
    "features": [
      "Header MessageCircle (ğŸ’¬) ë²„íŠ¼ìœ¼ë¡œ ì—´ê¸°",
      "320px~800px ë¦¬ì‚¬ì´ì§•",
      "ì ‘ê¸°/í¼ì¹˜ê¸° ì• ë‹ˆë©”ì´ì…˜",
      "ëª¨ë“  í†µê³„ í˜ì´ì§€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥"
    ]
  },
  "bestPractices": [
    {
      "title": "ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬",
      "description": "íƒ€ì´í•‘ íš¨ê³¼ë¥¼ ìœ„í•œ ì²­í¬ ë‹¨ìœ„ ì²˜ë¦¬",
      "example": "const [streamingText, setStreamingText] = useState('');\n\nconst response = await queryRAGStream(\n  query,\n  (chunk) => {\n    setStreamingText(prev => prev + chunk);\n  }\n);\n\n// ì™„ë£Œ í›„\nsetMessages([...messages, { query, response, timestamp: Date.now() }]);\nsetStreamingText('');  // ì´ˆê¸°í™”"
    },
    {
      "title": "ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´",
      "description": "Ollama ì„œë²„ ì—°ê²° ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€",
      "example": "try {\n  const response = await queryRAGStream(query, onChunk);\n} catch (err) {\n  const friendlyError = handleRAGError(err);\n  setError(friendlyError);\n  \n  // Ollama ì„œë²„ ë¬¸ì œì¸ ê²½ìš°\n  if (friendlyError.includes('Ollama')) {\n    setShowOllamaSetup(true);  // ì„¤ì • ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n  }\n}"
    },
    {
      "title": "ì„¸ì…˜ ê´€ë¦¬",
      "description": "IndexedDBë¥¼ ì‚¬ìš©í•œ ë¡œì»¬ ì„¸ì…˜ ì €ì¥",
      "example": "// ì„¸ì…˜ ì´ˆê¸°í™”\nconst storage = new ChatStorageIndexedDB();\nawait storage.initialize();\n\n// ìƒˆ ì„¸ì…˜ ìƒì„±\nconst newSession = {\n  id: crypto.randomUUID(),\n  name: `í†µê³„ ì§ˆë¬¸ ${new Date().toLocaleDateString()}`,\n  messages: [],\n  createdAt: Date.now(),\n  updatedAt: Date.now()\n};\n\nawait storage.saveSession(newSession);\nsetCurrentSessionId(newSession.id);"
    },
    {
      "title": "ì¸ë¼ì¸ ì¸ìš© ë Œë”ë§",
      "description": "Perplexity ìŠ¤íƒ€ì¼ [1], [2] ì¸ìš©",
      "example": "// ReactMarkdown custom components\nconst components = {\n  p: ({ children }) => {\n    // [1], [2] íŒ¨í„´ ê°ì§€ ë° ìŠ¤íƒ€ì¼ë§\n    const text = String(children);\n    const citationRegex = /\\[(\\d+)\\]/g;\n    \n    return (\n      <p className=\"mb-3\">\n        {text.split(citationRegex).map((part, i) => {\n          if (i % 2 === 1) {\n            // ì¸ìš© ë²ˆí˜¸\n            return (\n              <sup\n                key={i}\n                className=\"text-blue-600 cursor-pointer hover:underline\"\n                onClick={() => scrollToSource(Number(part))}\n              >\n                [{part}]\n              </sup>\n            );\n          }\n          return part;\n        })}\n      </p>\n    );\n  }\n};\n\n<ReactMarkdown components={components}>\n  {response.answer}\n</ReactMarkdown>"
    }
  ],
  "troubleshooting": [
    {
      "issue": "Ollama ì„œë²„ ì—°ê²° ì‹¤íŒ¨",
      "symptoms": "\"Ollama ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤\" ì—ëŸ¬",
      "solutions": [
        "1. Ollama ì„œë²„ ì‹¤í–‰ í™•ì¸: `ollama serve`",
        "2. í™˜ê²½ë³€ìˆ˜ í™•ì¸: NEXT_PUBLIC_OLLAMA_ENDPOINT",
        "3. ë°©í™”ë²½ ì„¤ì • í™•ì¸ (í¬íŠ¸ 11434)",
        "4. ëª¨ë¸ ë‹¤ìš´ë¡œë“œ: `ollama pull llama3.2:3b`"
      ]
    },
    {
      "issue": "Vector Store ë¡œë”© ì‹¤íŒ¨",
      "symptoms": "\"Vector storeë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\" ì—ëŸ¬",
      "solutions": [
        "1. public/rag-data/ í´ë” í™•ì¸",
        "2. vector-stores.json ë©”íƒ€ë°ì´í„° í™•ì¸",
        "3. IndexedDB ìºì‹œ í´ë¦¬ì–´ (ê°œë°œì ë„êµ¬)",
        "4. ì¬ë¹Œë“œ: `npm run build`"
      ]
    },
    {
      "issue": "ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ëŠê¹€",
      "symptoms": "ì‘ë‹µì´ ì¤‘ê°„ì— ë©ˆì¶¤",
      "solutions": [
        "1. ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸",
        "2. Ollama ì„œë²„ ë¡œê·¸ í™•ì¸",
        "3. maxTokens ì„¤ì • í™•ì¸ (ë„ˆë¬´ ì‘ìœ¼ë©´ ì¡°ê¸° ì¢…ë£Œ)",
        "4. íƒ€ì„ì•„ì›ƒ ì„¤ì • í™•ì¸"
      ]
    }
  ]
}
