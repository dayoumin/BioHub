{
  "id": "statistics-page-pattern",
  "version": "1.2.0",
  "lastUpdated": "2025-11-27",
  "sources": [
    "statistical-platform/docs/STATISTICS_CODING_STANDARDS.md",
    "statistical-platform/docs/AI-CODING-RULES.md",
    "statistical-platform/docs/TROUBLESHOOTING_ISANALYZING_BUG.md"
  ],
  "mandatoryRules": [
    {
      "id": "use-statistics-page-hook",
      "rule": "useStatisticsPage Hook 사용 필수",
      "correct": "const { state, actions } = useStatisticsPage<ResultType, VariableType>({ withUploadedData: true, withError: true });",
      "forbidden": "const [data, setData] = useState([]);",
      "reason": "상태 관리 표준화 + isAnalyzing 자동 관리",
      "severity": "critical"
    },
    {
      "id": "use-callback-pattern",
      "rule": "useCallback 모든 이벤트 핸들러에 적용",
      "correct": "const runAnalysis = useCallback(async () => { ... }, [uploadedData, actions]);",
      "forbidden": "const runAnalysis = async () => { ... };",
      "reason": "불필요한 리렌더링 방지",
      "severity": "warning"
    },
    {
      "id": "await-pattern",
      "rule": "await 패턴 사용 (setTimeout 금지)",
      "correct": "await pyodideCore.callMethod('worker1', 'ttest', data);",
      "forbidden": "setTimeout(() => { setResults(...) }, 100);",
      "reason": "React 18 automatic batching 활용",
      "severity": "critical"
    },
    {
      "id": "type-guard",
      "rule": "타입 가드 사용 (any 금지)",
      "correct": "if (!isValidData(data)) return;",
      "forbidden": "const result = data as any;",
      "reason": "타입 안전성 보장",
      "severity": "error"
    },
    {
      "id": "complete-analysis",
      "rule": "completeAnalysis 호출 필수 (setResults 금지)",
      "correct": "actions.completeAnalysis(result, 3);",
      "forbidden": "actions.setResults(result);",
      "reason": "isAnalyzing 상태 자동 리셋",
      "severity": "critical"
    },
    {
      "id": "nullish-coalescing-toFixed",
      "rule": "Nullish coalescing 패턴 (.toFixed() 호출 전)",
      "correct": "{(value ?? 0).toFixed(4)}",
      "forbidden": "{value.toFixed(4)}",
      "reason": "optional 타입 필드가 undefined일 때 TypeError 방지",
      "severity": "error"
    }
  ],
  "criticalBugs": [
    {
      "name": "isAnalyzing 상태 누락",
      "symptom": "분석 중 버튼 클릭 가능 → 중복 실행",
      "cause": "actions.startAnalysis() 호출 누락",
      "fix": "runAnalysis 시작 시 반드시 actions.startAnalysis() 호출",
      "severity": "critical",
      "reference": "TROUBLESHOOTING_ISANALYZING_BUG.md"
    },
    {
      "name": "completeAnalysis 호출 누락",
      "symptom": "isAnalyzing이 true로 고정 → UI 먹통",
      "cause": "에러 처리 블록에서 상태 정리 누락",
      "fix": "try-catch 모두에서 상태 정리 필수 (completeAnalysis 또는 setError)",
      "severity": "critical",
      "reference": "TROUBLESHOOTING_ISANALYZING_BUG.md"
    },
    {
      "name": "toFixed() TypeError",
      "symptom": "Cannot read properties of undefined (reading 'toFixed')",
      "cause": "optional 타입 필드에 직접 .toFixed() 호출",
      "fix": "Nullish coalescing 사용: (value ?? 0).toFixed(4)",
      "severity": "error",
      "reference": "DataExplorationStep.tsx:497"
    }
  ],
  "template": "'use client';\nimport { useStatisticsPage } from '@/hooks/use-statistics-page';\nimport { useCallback } from 'react';\nimport { PyodideCoreService } from '@/lib/services/pyodide/core/pyodide-core.service';\n\nexport default function NewStatisticsPage() {\n  const { state, actions } = useStatisticsPage<ResultType, VariableType>({\n    withUploadedData: true,\n    withError: true\n  });\n\n  const { uploadedData, isAnalyzing, results, error } = state;\n\n  const runAnalysis = useCallback(async (variables: Variables) => {\n    if (!uploadedData) return;\n    \n    // 1. 분석 시작 (isAnalyzing = true)\n    actions.startAnalysis();\n    \n    try {\n      // 2. PyodideCore 초기화\n      const pyodideCore = PyodideCoreService.getInstance();\n      await pyodideCore.initialize();\n      \n      // 3. Worker 호출\n      const result = await pyodideCore.callWorkerMethod<ResultType>(\n        1, // worker1-descriptive.py\n        'method-name',\n        {\n          data: uploadedData.data,\n          variables\n        }\n      );\n      \n      // 4. 분석 완료 (isAnalyzing = false + 결과 저장)\n      actions.completeAnalysis(result, 3);\n    } catch (err) {\n      const message = err instanceof Error ? err.message : '분석 중 오류가 발생했습니다.';\n      // 5. 에러 처리 (isAnalyzing = false)\n      actions.setError(message);\n    }\n  }, [uploadedData, actions]);\n\n  return (\n    <StatisticsPageLayout>\n      {/* Your code here */}\n    </StatisticsPageLayout>\n  );\n}",
  "relatedAPIs": {
    "hooks": [
      "useStatisticsPage",
      "usePyodideService"
    ],
    "types": [
      "StatisticsPageState",
      "StatisticsPageActions"
    ],
    "utilities": [
      "isValidData",
      "isNonEmptyArray"
    ],
    "services": [
      "PyodideCoreService"
    ]
  },
  "pyodideWorkerMapping": {
    "worker1": "scipy only (descriptive_stats, normality_test, outlier_detection, cronbach_alpha, bonferroni_correction)",
    "worker2": "scipy + statsmodels (t-test, z-test, chi-square, correlation, levene_test)",
    "worker3": "scikit-learn (nonparametric: Mann-Whitney, Kruskal-Wallis, Friedman + ANOVA: one-way, two-way, repeated-measures, ANCOVA, MANOVA + post-hoc: Tukey, Scheffe, Games-Howell)",
    "worker4": "scikit-learn (regression: linear, multiple, logistic + advanced: PCA, factor analysis, cluster analysis)"
  },
  "relatedDocumentation": {
    "analysisFlowArchitecture": {
      "location": "Design System > Test Snippets > Analysis Flow Architecture",
      "description": "UI → Executor → Service → Core → Worker 전체 흐름 상세 문서"
    },
    "workerMappingTests": {
      "location": "__tests__/pyodide/worker-function-mapping.test.ts",
      "description": "Worker-Function 매핑 검증 테스트 (61개)"
    }
  }
}