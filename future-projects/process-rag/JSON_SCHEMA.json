{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Process Definition",
  "description": "업무 프로세스 정의 JSON 스키마 (v1.0)",
  "type": "object",
  "required": ["id", "name", "version", "steps"],
  "properties": {
    "id": {
      "type": "string",
      "description": "프로세스 고유 ID (예: contract-process-v1.2)",
      "pattern": "^[a-z0-9-]+$",
      "examples": ["contract-process-v1.2", "facility-inspection-v2.0"]
    },
    "name": {
      "type": "string",
      "description": "프로세스 이름",
      "examples": ["계약 체결 절차", "시설 점검 프로세스"]
    },
    "department": {
      "type": "string",
      "description": "담당 부서",
      "examples": ["계약팀", "시설팀", "예산팀"]
    },
    "createdBy": {
      "type": "string",
      "description": "생성자 이름",
      "examples": ["홍길동"]
    },
    "version": {
      "type": "string",
      "description": "프로세스 버전 (Semantic Versioning)",
      "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
      "examples": ["1.0", "1.2", "2.0.1"]
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "생성 일시 (ISO 8601)",
      "examples": ["2025-01-18T09:00:00Z"]
    },
    "description": {
      "type": "string",
      "description": "프로세스 설명",
      "examples": ["계약 체결부터 등록까지의 전체 절차"]
    },
    "tags": {
      "type": "array",
      "description": "검색용 태그",
      "items": {
        "type": "string"
      },
      "examples": [["계약", "입찰", "법무"]]
    },
    "steps": {
      "type": "array",
      "description": "프로세스 단계 목록",
      "items": {
        "$ref": "#/definitions/ProcessStep"
      }
    },
    "changelog": {
      "type": "array",
      "description": "변경 이력",
      "items": {
        "type": "object",
        "required": ["version", "date", "changes"],
        "properties": {
          "version": {
            "type": "string",
            "description": "버전 번호"
          },
          "date": {
            "type": "string",
            "format": "date",
            "description": "변경 일자"
          },
          "changes": {
            "type": "array",
            "description": "변경 사항",
            "items": {
              "type": "string"
            }
          },
          "author": {
            "type": "string",
            "description": "변경자 이름"
          }
        }
      }
    }
  },
  "definitions": {
    "ProcessStep": {
      "type": "object",
      "required": ["id", "type", "title"],
      "properties": {
        "id": {
          "type": "string",
          "description": "단계 고유 ID",
          "pattern": "^step-[0-9]+$",
          "examples": ["step-1", "step-2"]
        },
        "type": {
          "type": "string",
          "description": "단계 유형",
          "enum": ["task", "branch", "file"],
          "examples": ["task"]
        },
        "title": {
          "type": "string",
          "description": "단계 제목",
          "examples": ["입찰 공고 작성", "법무 검토"]
        },
        "description": {
          "type": "string",
          "description": "단계 설명",
          "examples": ["입찰 공고문을 작성하고 예산을 확인합니다"]
        },
        "checklist": {
          "type": "array",
          "description": "체크리스트 항목",
          "items": {
            "$ref": "#/definitions/ChecklistItem"
          }
        },
        "files": {
          "type": "array",
          "description": "필요 서류 목록",
          "items": {
            "$ref": "#/definitions/FileSlot"
          }
        },
        "ragQuery": {
          "type": "string",
          "description": "RAG 챗봇 질문 힌트",
          "examples": ["입찰 공고 작성 가이드라인", "법무 검토 기준"]
        },
        "branch": {
          "$ref": "#/definitions/BranchCondition",
          "description": "조건 분기 (type이 'branch'일 때만)"
        },
        "nextSteps": {
          "type": "array",
          "description": "다음 단계 ID 목록",
          "items": {
            "type": "string"
          },
          "examples": [["step-2", "step-3"]]
        },
        "estimated": {
          "type": "string",
          "description": "예상 소요 시간",
          "examples": ["1일", "3시간", "1주"]
        }
      }
    },
    "ChecklistItem": {
      "type": "object",
      "required": ["text"],
      "properties": {
        "text": {
          "type": "string",
          "description": "체크리스트 항목 텍스트",
          "examples": ["입찰 공고문 작성", "예산 범위 확인"]
        },
        "required": {
          "type": "boolean",
          "description": "필수 항목 여부",
          "default": false
        }
      }
    },
    "FileSlot": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "서류 이름",
          "examples": ["입찰 공고문", "계약서 초안"]
        },
        "format": {
          "type": "string",
          "description": "파일 형식",
          "examples": ["PDF", "DOCX", "XLSX", "PDF/DOCX"]
        },
        "required": {
          "type": "boolean",
          "description": "필수 서류 여부",
          "default": false
        }
      }
    },
    "BranchCondition": {
      "type": "object",
      "required": ["question"],
      "properties": {
        "question": {
          "type": "string",
          "description": "분기 질문",
          "examples": ["수정이 필요한가요?", "예산이 1억 원을 초과하나요?"]
        },
        "yes": {
          "type": "string",
          "description": "Yes 선택 시 다음 단계 ID",
          "examples": ["step-1", "step-5"]
        },
        "no": {
          "type": "string",
          "description": "No 선택 시 다음 단계 ID",
          "examples": ["step-3", "step-4"]
        }
      }
    }
  },
  "examples": [
    {
      "id": "contract-process-v1.2",
      "name": "계약 체결 절차",
      "department": "계약팀",
      "createdBy": "홍길동",
      "version": "1.2",
      "createdAt": "2025-01-18T09:00:00Z",
      "description": "입찰 공고부터 계약 체결까지의 전체 절차",
      "tags": ["계약", "입찰", "법무"],
      "steps": [
        {
          "id": "step-1",
          "type": "task",
          "title": "입찰 공고 작성",
          "description": "입찰 공고문을 작성하고 예산을 확인합니다",
          "checklist": [
            { "text": "입찰 공고문 작성", "required": true },
            { "text": "예산 범위 확인", "required": true },
            { "text": "법무팀 사전 검토", "required": false }
          ],
          "files": [
            { "name": "입찰 공고문", "format": "PDF", "required": true },
            { "name": "예산 증빙", "format": "XLSX", "required": true }
          ],
          "ragQuery": "입찰 공고 작성 가이드라인",
          "nextSteps": ["step-2"],
          "estimated": "1일"
        },
        {
          "id": "step-2",
          "type": "branch",
          "title": "법무 검토",
          "description": "법무팀에서 계약서를 검토합니다",
          "checklist": [
            { "text": "계약서 초안 제출", "required": true },
            { "text": "법률 위반 여부 확인", "required": true }
          ],
          "ragQuery": "법무 검토 기준",
          "branch": {
            "question": "수정이 필요한가요?",
            "yes": "step-1",
            "no": "step-3"
          },
          "estimated": "3일"
        },
        {
          "id": "step-3",
          "type": "task",
          "title": "계약 체결",
          "description": "최종 계약을 체결하고 등록합니다",
          "checklist": [
            { "text": "계약서 날인", "required": true },
            { "text": "계약 등록", "required": true }
          ],
          "files": [
            { "name": "최종 계약서", "format": "PDF", "required": true }
          ],
          "ragQuery": "계약 등록 절차",
          "nextSteps": [],
          "estimated": "1일"
        }
      ],
      "changelog": [
        {
          "version": "1.2",
          "date": "2025-01-18",
          "changes": [
            "법무 검토 단계 조건 분기 추가",
            "예산 증빙 서류 필수화"
          ],
          "author": "홍길동"
        },
        {
          "version": "1.1",
          "date": "2025-01-10",
          "changes": ["체크리스트 항목 추가"],
          "author": "김철수"
        }
      ]
    }
  ]
}
