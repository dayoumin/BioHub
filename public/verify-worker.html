<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Worker í™˜ê²½ ê²€ì¦</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #4CAF50;
      padding-bottom: 10px;
    }
    .result {
      margin: 20px 0;
      padding: 15px;
      border-left: 4px solid #ddd;
      background: #f9f9f9;
    }
    .result.pass { border-color: #4CAF50; background: #f1f8f4; }
    .result.fail { border-color: #f44336; background: #fef1f0; }
    .result.warn { border-color: #ff9800; background: #fff8e1; }
    .icon { font-size: 24px; margin-right: 10px; }
    .details { margin-top: 10px; font-size: 14px; color: #666; }
    .recommendation {
      margin-top: 10px;
      padding: 10px;
      background: #fff3cd;
      border-radius: 4px;
      font-size: 13px;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
    }
    button:hover { background: #45a049; }
    pre {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
    .summary {
      margin-top: 30px;
      padding: 20px;
      border-radius: 8px;
      font-size: 16px;
    }
    .summary h3 { margin-top: 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” Web Worker í™˜ê²½ ê²€ì¦</h1>
    <p><strong>ëª©ì :</strong> Phase 5-3 Worker Pool êµ¬í˜„ì„ ìœ„í•œ ë¸Œë¼ìš°ì € í™˜ê²½ ê²€ì¦</p>
    <p><strong>ê²€ì¦ í•­ëª©:</strong> Web Worker API, SharedArrayBuffer, IndexedDB, ë©”ëª¨ë¦¬ ì œí•œ, ë¸Œë¼ìš°ì € í˜¸í™˜ì„±</p>

    <button onclick="runVerification()">ğŸš€ ê²€ì¦ ì‹œì‘</button>

    <div id="results"></div>
  </div>

  <script>
    function runVerification() {
      const results = [];

      // 1. Web Worker API
      results.push({
        feature: 'Web Worker API',
        supported: typeof Worker !== 'undefined',
        required: true,
        details: typeof Worker !== 'undefined'
          ? 'âœ“ Worker constructor ì‚¬ìš© ê°€ëŠ¥'
          : 'âœ— Worker constructorë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
        recommendation: typeof Worker === 'undefined'
          ? 'âŒ CRITICAL: ë¸Œë¼ìš°ì €ë¥¼ ìµœì‹  ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜ Web Workerë¥¼ ì§€ì›í•˜ëŠ” ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.'
          : null
      });

      // 2. SharedArrayBuffer
      const hasSharedArrayBuffer = typeof SharedArrayBuffer !== 'undefined';
      results.push({
        feature: 'SharedArrayBuffer',
        supported: hasSharedArrayBuffer,
        required: false,
        details: hasSharedArrayBuffer
          ? 'âœ“ Pyodide ì„±ëŠ¥ ìµœì í™” ê°€ëŠ¥ (ë©€í‹°ìŠ¤ë ˆë“œ ì§€ì›)'
          : 'âœ— COOP/COEP í—¤ë” ì„¤ì • í•„ìš” (ë‹¨ì¼ ìŠ¤ë ˆë“œ ì œí•œ)',
        recommendation: !hasSharedArrayBuffer
          ? 'âš ï¸ WARNING: Pyodideê°€ ë‹¨ì¼ ìŠ¤ë ˆë“œ ëª¨ë“œë¡œ ì‘ë™í•©ë‹ˆë‹¤. ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ ë‹¤ìŒ í—¤ë”ë¥¼ ì„¤ì •í•˜ì„¸ìš”:\n' +
            'Cross-Origin-Opener-Policy: same-origin\n' +
            'Cross-Origin-Embedder-Policy: require-corp'
          : null
      });

      // 3. Worker Module Support
      let workerModuleSupported = false;
      try {
        const testCode = 'export default self';
        const blob = new Blob([testCode], { type: 'application/javascript' });
        const url = URL.createObjectURL(blob);
        workerModuleSupported = true;
        URL.revokeObjectURL(url);
      } catch (err) {
        workerModuleSupported = false;
      }

      results.push({
        feature: 'Worker Modules (ES Modules)',
        supported: workerModuleSupported,
        required: false,
        details: workerModuleSupported
          ? 'âœ“ Workerì—ì„œ ES Modules ì‚¬ìš© ê°€ëŠ¥ (type: "module")'
          : 'âœ— Classic Workerë§Œ ì§€ì›',
        recommendation: !workerModuleSupported
          ? 'âš ï¸ WARNING: Worker Module ë¯¸ì§€ì›. Classic Worker ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.'
          : null
      });

      // 4. IndexedDB
      results.push({
        feature: 'IndexedDB',
        supported: typeof indexedDB !== 'undefined',
        required: false,
        details: typeof indexedDB !== 'undefined'
          ? 'âœ“ Pyodide íŒ¨í‚¤ì§€ ìºì‹± ê°€ëŠ¥ (ë¹ ë¥¸ ì¬ë¡œë”©)'
          : 'âœ— íŒ¨í‚¤ì§€ë¥¼ ë§¤ë²ˆ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë‹¤ìš´ë¡œë“œ',
        recommendation: typeof indexedDB === 'undefined'
          ? 'âš ï¸ WARNING: Pyodide íŒ¨í‚¤ì§€ë¥¼ ë§¤ë²ˆ ë‹¤ìš´ë¡œë“œí•˜ë¯€ë¡œ ì´ˆê¸° ë¡œë”©ì´ ëŠë¦½ë‹ˆë‹¤.'
          : null
      });

      // 5. Memory Info (Chrome only)
      let memoryDetails = 'ì •ë³´ ì—†ìŒ (Chrome ì „ìš© API)';
      let memoryRecommendation = null;

      if (performance.memory) {
        const limitMB = Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024);
        const usedMB = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
        memoryDetails = `Heap ì œí•œ: ${limitMB} MB / í˜„ì¬ ì‚¬ìš©: ${usedMB} MB`;

        if (limitMB < 2048) {
          memoryRecommendation = `âš ï¸ WARNING: ë©”ëª¨ë¦¬ ì œí•œì´ ë‚®ìŠµë‹ˆë‹¤ (${limitMB} MB). ëŒ€ìš©ëŸ‰ ë°ì´í„°ì…‹(10,000+ í–‰) ì²˜ë¦¬ ì‹œ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
        }
      }

      results.push({
        feature: 'Memory Limits',
        supported: true,
        required: false,
        details: memoryDetails,
        recommendation: memoryRecommendation
      });

      // 6. Browser Info
      const getBrowserInfo = () => {
        const ua = navigator.userAgent;
        if (ua.indexOf('Chrome') > -1) return 'Chrome/Edge';
        if (ua.indexOf('Firefox') > -1) return 'Firefox';
        if (ua.indexOf('Safari') > -1) return 'Safari';
        return 'Unknown';
      };

      results.push({
        feature: 'Browser',
        supported: true,
        required: false,
        details: `${getBrowserInfo()} | ${navigator.userAgent}`,
        recommendation: null
      });

      displayResults(results);
    }

    function displayResults(results) {
      const container = document.getElementById('results');
      container.innerHTML = '<h2 style="margin-top: 40px;">ğŸ“Š ê²€ì¦ ê²°ê³¼</h2>';

      results.forEach((result, index) => {
        const status = result.supported ? 'pass' : (result.required ? 'fail' : 'warn');
        const icon = result.supported ? 'âœ…' : (result.required ? 'âŒ' : 'âš ï¸');
        const required = result.required ? '<span style="color: #d32f2f;">[í•„ìˆ˜]</span>' : '<span style="color: #f57c00;">[ì„ íƒ]</span>';

        const div = document.createElement('div');
        div.className = `result ${status}`;
        div.innerHTML = `
          <div>
            <span class="icon">${icon}</span>
            <strong>${result.feature}</strong> ${required}
          </div>
          <div class="details">${result.details}</div>
          ${result.recommendation ? `<div class="recommendation">ğŸ’¡ ${result.recommendation.replace(/\n/g, '<br>')}</div>` : ''}
        `;
        container.appendChild(div);
      });

      // Summary
      const blockers = results.filter(r => r.required && !r.supported);
      const warnings = results.filter(r => !r.required && !r.supported);

      const summary = document.createElement('div');
      summary.className = 'summary';

      if (blockers.length > 0) {
        summary.style.background = '#fef1f0';
        summary.style.border = '2px solid #f44336';
        summary.innerHTML = `
          <h3>âŒ ê²€ì¦ ì‹¤íŒ¨: ë¸”ë¡œì»¤ ë°œê²¬!</h3>
          <p><strong>${blockers.length}ê°œì˜ í•„ìˆ˜ ê¸°ëŠ¥ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong></p>
          <p>Phase 5-3 Worker Pool êµ¬í˜„ì„ ì‹œì‘í•˜ê¸° ì „ì— ë‹¤ìŒ ë¬¸ì œë¥¼ í•´ê²°í•˜ì„¸ìš”:</p>
          <ul>
            ${blockers.map(b => `<li>${b.feature}: ${b.recommendation}</li>`).join('')}
          </ul>
        `;
      } else if (warnings.length > 0) {
        summary.style.background = '#fff8e1';
        summary.style.border = '2px solid #ff9800';
        summary.innerHTML = `
          <h3>âš ï¸ ê²€ì¦ í†µê³¼ (ê²½ê³  ìˆìŒ)</h3>
          <p><strong>Worker Pool êµ¬í˜„ ê°€ëŠ¥í•˜ì§€ë§Œ ${warnings.length}ê°œì˜ ì„ íƒ ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤.</strong></p>
          <p>ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ë‹¤ìŒ ê¶Œì¥ì‚¬í•­ì„ ê²€í† í•˜ì„¸ìš”:</p>
          <ul>
            ${warnings.map(w => `<li>${w.feature}: ${w.recommendation || 'ì„±ëŠ¥ ì œí•œ ê°€ëŠ¥'}</li>`).join('')}
          </ul>
          <p style="margin-top: 20px; color: #2e7d32;"><strong>âœ… Phase 5-3 AdaptiveWorkerPool êµ¬í˜„ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</strong></p>
        `;
      } else {
        summary.style.background = '#f1f8f4';
        summary.style.border = '2px solid #4CAF50';
        summary.innerHTML = `
          <h3>âœ… ê²€ì¦ ì™„ë£Œ: ëª¨ë“  ê¸°ëŠ¥ ì§€ì›!</h3>
          <p><strong>ìµœì  í™˜ê²½ì…ë‹ˆë‹¤. Worker Poolì˜ ëª¨ë“  ì„±ëŠ¥ ìµœì í™”ë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong></p>
          <ul>
            <li>âœ“ Web Worker API ì§€ì›</li>
            <li>âœ“ SharedArrayBuffer ì§€ì› (ë©€í‹°ìŠ¤ë ˆë“œ)</li>
            <li>âœ“ IndexedDB ìºì‹± ì§€ì›</li>
            <li>âœ“ ì¶©ë¶„í•œ ë©”ëª¨ë¦¬</li>
          </ul>
          <p style="margin-top: 20px; color: #2e7d32; font-size: 18px;"><strong>ğŸš€ Phase 5-3 AdaptiveWorkerPool êµ¬í˜„ ì¤€ë¹„ ì™„ë£Œ!</strong></p>
        `;
      }

      container.appendChild(summary);
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
    window.addEventListener('load', () => {
      // ìë™ ì‹¤í–‰í•˜ì§€ ì•Šê³  ì‚¬ìš©ìê°€ ë²„íŠ¼ í´ë¦­í•˜ë„ë¡ ìœ ë„
    });
  </script>
</body>
</html>
